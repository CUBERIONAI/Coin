<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ukrainian Cyborgs: Reborn</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        /* --- UKRAINIAN CYBORG THEME (v1.4) --- */
        :root {
            --neon-blue: #00f3ff;
            --neon-yellow: #ffd700;
            --hud-bg: rgba(10, 20, 30, 0.95);
            --hud-border: #005577;
            --bg-dark: #020205;
            --text-main: #e0faff;
            --danger: #ff2a2a;
            --success: #00ff88;
        }

        @font-face {
            font-family: 'HUD';
            src: local('Courier New'); /* Fallback */
        }

        body {
            font-family: 'HUD', 'Courier New', monospace;
            background-color: var(--bg-dark);
            color: var(--text-main); margin: 0; padding: 0;
            display: flex; flex-direction: column; align-items: center;
            height: 100vh; overflow: hidden;
            user-select: none; -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 90px; /* Space for nav */
        }

        /* DYNAMIC MILITARY BACKGROUND */
        .bg-grid {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2;
            background: 
                linear-gradient(rgba(0, 20, 40, 0.9), rgba(0, 5, 10, 0.95)),
                repeating-linear-gradient(0deg, transparent 0, transparent 49px, rgba(0, 243, 255, 0.05) 50px),
                repeating-linear-gradient(90deg, transparent 0, transparent 49px, rgba(0, 243, 255, 0.05) 50px);
            background-size: 100% 100%, 50px 50px, 50px 50px;
            animation: scanline 10s linear infinite;
        }

        /* HEADER */
        .header {
            width: 100%; padding: 15px; box-sizing: border-box;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--hud-border);
            background: linear-gradient(180deg, rgba(0,40,60,0.8), transparent);
            backdrop-filter: blur(5px);
        }
        .user-info { display: flex; align-items: center; gap: 10px; }
        .user-avatar { width: 32px; height: 32px; border-radius: 4px; border: 1px solid var(--neon-blue); background: #000; }
        
        /* MAIN DISPLAY */
        .balance-container { text-align: center; margin-top: 20px; text-shadow: 0 0 15px var(--neon-blue); }
        .balance-val { font-size: 42px; font-weight: 900; letter-spacing: 1px; color: #fff; }
        .league-badge { 
            font-size: 12px; color: var(--neon-yellow); border: 1px solid var(--neon-yellow);
            padding: 2px 8px; border-radius: 4px; text-transform: uppercase; letter-spacing: 2px;
            cursor: pointer; background: rgba(255, 215, 0, 0.1);
        }

        /* TRIDENT BUTTON area */
        .game-area {
            flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center;
            width: 100%; position: relative;
        }
        
        .clicker-btn {
            width: 260px; height: 260px; border-radius: 50%;
            background: radial-gradient(circle, #001a33, #000);
            border: 2px solid var(--hud-border);
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.2), inset 0 0 20px rgba(0, 243, 255, 0.1);
            position: relative; display: flex; justify-content: center; align-items: center;
            transition: transform 0.05s; z-index: 10; cursor: pointer;
            -webkit-touch-callout: none;
        }
        .clicker-btn:active { transform: scale(0.95); border-color: var(--neon-yellow); box-shadow: 0 0 30px var(--neon-yellow); }
        
        .trident-svg { width: 65%; height: 65%; filter: drop-shadow(0 0 10px var(--neon-blue)); transition: filter 0.3s; }
        .turbo-mode .trident-svg { filter: drop-shadow(0 0 15px var(--danger)); }

        /* ENERGY HUD */
        .energy-container { width: 90%; max-width: 400px; margin-bottom: 10px; }
        .energy-bar-bg { width: 100%; height: 6px; background: #111; border: 1px solid #333; border-radius: 2px; }
        .energy-fill { height: 100%; background: var(--neon-blue); width: 100%; box-shadow: 0 0 10px var(--neon-blue); transition: width 0.2s; }
        .energy-text { display: flex; justify-content: space-between; font-size: 10px; color: #888; margin-top: 4px; text-transform: uppercase; }

        /* NAVIGATION */
        .nav-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 80px;
            background: var(--hud-bg); border-top: 1px solid var(--hud-border);
            display: flex; justify-content: space-around; align-items: center;
            padding-bottom: 10px; z-index: 100; box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: #557; font-size: 10px; font-weight: bold; width: 20%; height: 100%;
            cursor: pointer; transition: color 0.2s;
        }
        .nav-item.active { color: var(--neon-blue); text-shadow: 0 0 8px var(--neon-blue); }
        .nav-icon { font-size: 20px; margin-bottom: 5px; }

        /* MODALS / SECTIONS */
        .section-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-dark); z-index: 50; display: none;
            flex-direction: column; overflow-y: auto; padding-bottom: 90px;
        }
        .section-header {
            padding: 20px; text-align: center; border-bottom: 1px solid var(--hud-border);
            background: rgba(0,20,40,0.8); position: sticky; top: 0; backdrop-filter: blur(10px);
        }
        .section-title { font-size: 20px; color: var(--neon-yellow); text-transform: uppercase; letter-spacing: 2px; margin: 0; }
        
        .card-list { padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .card {
            background: rgba(255,255,255,0.03); border: 1px solid #333;
            padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;
        }
        .card-left { display: flex; flex-direction: column; gap: 4px; }
        .card-title { font-size: 14px; color: #fff; font-weight: bold; }
        .card-desc { font-size: 11px; color: #777; }
        
        .btn-action {
            background: rgba(0, 243, 255, 0.1); border: 1px solid var(--neon-blue);
            color: var(--neon-blue); padding: 8px 16px; border-radius: 4px;
            font-size: 12px; font-weight: bold; cursor: pointer;
            text-transform: uppercase;
        }
        .btn-action:disabled { border-color: #444; color: #444; background: transparent; }

        /* Floating Text */
        .float-txt {
            position: absolute; font-size: 28px; font-weight: bold; color: #fff;
            pointer-events: none; animation: floatUp 0.8s forwards;
        }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-80px); } }

        /* NOTIFICATION */
        .toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.9); border: 1px solid var(--neon-yellow);
            color: var(--neon-yellow); padding: 10px 20px; border-radius: 20px;
            font-size: 12px; z-index: 2000; opacity: 0; transition: opacity 0.3s;
            pointer-events: none;
        }

    </style>
</head>
<body>

    <div class="bg-grid"></div>
    <div id="toast" class="toast">Notification</div>

    <div id="screen-home" style="display: flex; flex-direction: column; width: 100%; height: 100%;">
        <div class="header">
            <div class="user-info">
                <div class="user-avatar"></div>
                <div style="font-size:12px; line-height:1.2;">
                    <div id="username">COMMANDER</div>
                    <div style="color:var(--neon-blue); font-size:10px;">ONLINE</div>
                </div>
            </div>
            <div id="ton-connect"></div>
        </div>

        <div class="balance-container">
            <div class="balance-val" id="displayBalance">0</div>
            <div class="league-badge" id="leagueLabel" onclick="showLeagues()">BRONZE</div>
        </div>

        <div class="game-area">
            <div class="clicker-btn" id="clickBtn">
                <svg class="trident-svg" viewBox="0 0 512 512">
                     <defs>
                        <linearGradient id="grad1" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#00f3ff;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#ffd700;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <path fill="url(#grad1)" d="M256 32C242.7 32 232 42.7 232 56V192C232 222.9 206.9 248 176 248C145.1 248 120 222.9 120 192V88C120 74.7 109.3 64 96 64C82.7 64 72 74.7 72 88V192C72 249.4 118.6 296 176 296H200V424H152C138.7 424 128 434.7 128 448C128 461.3 138.7 472 152 472H360C373.3 472 384 461.3 384 448C384 434.7 373.3 424 360 424H312V296H336C393.4 296 440 249.4 440 192V88C440 74.7 429.3 64 416 64C402.7 64 392 74.7 392 88V192C392 222.9 366.9 248 336 248C305.1 248 280 222.9 280 192V56C280 42.7 269.3 32 256 32z"/>
                </svg>
            </div>
            <div id="turbo-hud" style="display:none; position:absolute; bottom: -40px; color:var(--danger); font-weight:bold;">‚ö†Ô∏è TURBO ACTIVE</div>
        </div>

        <div class="energy-container" style="margin: 0 auto 20px auto;">
            <div class="energy-bar-bg"><div class="energy-fill" id="enFill"></div></div>
            <div class="energy-text">
                <span>SYSTEM ENERGY</span>
                <span><span id="enVal">1000</span> / <span id="enMax">1000</span></span>
            </div>
        </div>
    </div>

    <div id="section-earn" class="section-layer">
        <div class="section-header"><h2 class="section-title">MISSIONS</h2></div>
        <div class="card-list">
            <div style="text-align:center; padding:10px; color:#888; font-size:12px;">DAILY REWARDS</div>
            <div class="card" style="border-color:var(--neon-yellow);">
                <div class="card-left">
                    <div class="card-title">Daily Check-in</div>
                    <div class="card-desc">+100,000 Credits</div>
                </div>
                <button class="btn-action" id="btnDaily" onclick="claimDaily()">CLAIM</button>
            </div>

            <div style="text-align:center; padding:10px; color:#888; font-size:12px; margin-top:10px;">SPECIAL OPS</div>
            <div class="card">
                <div class="card-left">
                    <div class="card-title">Join Channel</div>
                    <div class="card-desc">@ucbgcoin (+1,000,000)</div>
                </div>
                <button class="btn-action" id="btnTask1" onclick="doTask('task1', 'https://t.me/ucbgcoin')">START</button>
            </div>
            <div class="card">
                <div class="card-left">
                    <div class="card-title">Join Squad Chat</div>
                    <div class="card-desc">@ukrainian_cyborgs_ton (+1M)</div>
                </div>
                <button class="btn-action" id="btnTask2" onclick="doTask('task2', 'https://t.me/ukrainian_cyborgs_ton')">START</button>
            </div>
        </div>
    </div>

    <div id="section-invest" class="section-layer">
        <div class="section-header"><h2 class="section-title">STAKING HUB</h2></div>
        <div class="card-list">
            <div style="background:#001; padding:20px; border-radius:10px; border:1px solid #333; text-align:center;">
                <div style="font-size:12px; color:#888;">CURRENT YIELD</div>
                <div style="font-size:32px; color:var(--neon-blue); margin:10px 0;" id="yieldDisplay">0</div>
                <div style="font-size:12px; color:#555;">COINS / HOUR</div>
            </div>
            
            <div class="card">
                <div class="card-left">
                    <div class="card-title">Lock 1 TON</div>
                    <div class="card-desc">Yield: 2,000/hr</div>
                </div>
                <button class="btn-action" onclick="showToast('Connecting Wallet...')">STAKE</button>
            </div>
            <div class="card">
                <div class="card-left">
                    <div class="card-title">Lock 10 TON</div>
                    <div class="card-desc">Yield: 40,000/hr (VIP)</div>
                </div>
                <button class="btn-action" onclick="showToast('Connecting Wallet...')">STAKE</button>
            </div>
            <div style="padding:10px; font-size:10px; color:#555; text-align:center;">
                Staking requires TON connection. Coins are mined automatically while staked.
            </div>
        </div>
    </div>

    <div id="section-team" class="section-layer">
        <div class="section-header"><h2 class="section-title">SQUAD</h2></div>
        <div class="card-list" style="text-align:center;">
            <div style="font-size:48px; margin:20px;">üë•</div>
            <div style="color:#fff; margin-bottom:10px;">Invite Recruits</div>
            <div style="color:#888; font-size:12px; margin-bottom:20px;">
                You: +500,000 <br> Friend: +250,000
            </div>
            <button class="btn-action" style="width:100%; padding:15px; font-size:16px;" onclick="inviteFriend()">
                INVITE FRIEND
            </button>
            <div style="margin-top:30px; border-top:1px solid #333; padding-top:20px;">
                <div style="font-size:12px; color:#555;">YOUR SQUAD LIST</div>
                <div id="friendsList" style="margin-top:10px; color:#888; font-size:14px;">No recruits yet.</div>
            </div>
        </div>
    </div>

    <div id="section-wallet" class="section-layer">
        <div class="section-header"><h2 class="section-title">ARMORY & NFT</h2></div>
        <div class="card-list">
            <div style="display:flex; justify-content:center; margin-bottom:20px;">
                <div id="ton-connect-inner"></div> 
            </div>

            <div class="card" style="border-color:var(--neon-blue); background:rgba(0,243,255,0.05);">
                <div class="card-left">
                    <div class="card-title">UCBG VOUCHER (NFT)</div>
                    <div class="card-desc">1 NFT = 1,000,000 Coins</div>
                </div>
                <button class="btn-action" onclick="openLink('https://getgems.io/collection/EQBiMglpS3o2nMB89NS0Wp6wgqacaOhT0QdZgQ_svTlhTdsO/EQDWHsTEXeaJEMcDfuyujSVf8VrHBlKljqKqFo1aDRDc6qvc')">BUY</button>
            </div>

            <div class="card">
                <div class="card-left">
                    <div class="card-title">Scan Wallet</div>
                    <div class="card-desc">Check for Vouchers</div>
                </div>
                <button class="btn-action" onclick="checkNFTs()">KVIT</button>
            </div>
        </div>
    </div>
    
    <div id="section-upgrade" class="section-layer">
        <div class="section-header"><h2 class="section-title">TECH UPGRADES</h2></div>
        <div class="card-list" id="upgradeList"></div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="nav('home', this)"><div class="nav-icon">üè†</div>BASE</div>
        <div class="nav-item" onclick="nav('earn', this)"><div class="nav-icon">üì°</div>EARN</div>
        <div class="nav-item" onclick="nav('upgrade', this)"><div class="nav-icon">üõ†</div>TECH</div>
        <div class="nav-item" onclick="nav('team', this)"><div class="nav-icon">üë•</div>TEAM</div>
        <div class="nav-item" onclick="nav('wallet', this)"><div class="nav-icon">üí†</div>WALLET</div>
    </div>

    <script>
        // --- CORE CONFIG ---
        const TG = window.Telegram.WebApp;
        TG.expand();
        TG.setHeaderColor('#020205');

        // STATE
        let game = {
            balance: 0,
            energy: 1000,
            maxEnergy: 1000,
            clickLvl: 1,
            energyLvl: 1,
            regenLvl: 1,
            lastLogin: 0,
            tasks: { task1: false, task2: false },
            referrals: 0,
            league: 0
        };

        const LEAGUES = [
            { name: "Recruit", limit: 0 },
            { name: "Soldier", limit: 500000 },
            { name: "Cyborg", limit: 2000000 },
            { name: "Titan", limit: 10000000 },
            { name: "Legend", limit: 50000000 }
        ];

        // --- INIT ---
        function init() {
            loadGame();
            
            // Check Referrals
            const initData = TG.initDataUnsafe;
            if (initData && initData.start_param && !localStorage.getItem('ucbg_ref_processed')) {
                // User came from a link like t.me/bot?startapp=123
                // In a real app, send API call to backend. Here we simulate.
                showToast("Referral Bonus: +250,000 Coins!");
                game.balance += 250000;
                localStorage.setItem('ucbg_ref_processed', 'true');
                saveGame();
            }

            if(initData && initData.user) {
                document.getElementById('username').textContent = initData.user.username || initData.user.first_name;
            }

            // Init UI
            updateUI();
            renderUpgrades();

            // Energy Loop
            setInterval(() => {
                if(game.energy < game.maxEnergy) {
                    game.energy = Math.min(game.maxEnergy, game.energy + (game.regenLvl * 2)); // v1.4 regen logic
                    updateUI();
                }
            }, 1000);

            // TON UI
            const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
                manifestUrl: 'https://raw.githubusercontent.com/ton-community/tutorials/main/03-client/test/public/tonconnect-manifest.json',
                buttonRootId: 'ton-connect'
            });
        }

        // --- NAVIGATION ---
        window.nav = (screen, btn) => {
            document.querySelectorAll('.section-layer').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            
            btn.classList.add('active');
            
            if(screen === 'home') {
                document.getElementById('screen-home').style.display = 'flex';
            } else {
                document.getElementById(`section-${screen}`).style.display = 'flex';
                // Only hide home if overlapping, but here we just overlay
            }
        };

        // --- GAMEPLAY ---
        const elBtn = document.getElementById('clickBtn');
        
        elBtn.addEventListener('pointerdown', (e) => {
            e.preventDefault(); // prevent zoom
            
            let power = game.clickLvl * 1; // Base formula
            if(game.energy >= power) {
                game.balance += power;
                game.energy -= power;
                
                // Visuals
                TG.HapticFeedback.impactOccurred('medium');
                showFloat(e.clientX, e.clientY, `+${power}`);
                elBtn.style.transform = "scale(0.95)";
                setTimeout(()=>elBtn.style.transform="scale(1)", 80);

                checkLeague();
                updateUI();
                saveGame();
            }
        });

        function showFloat(x, y, txt) {
            let el = document.createElement('div');
            el.clas

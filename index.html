<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ukrainian Cyborgs v5.1: Total War</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;600&display=swap" rel="stylesheet">
    
    <style>
        /* --- GLOBAL STYLES --- */
        :root {
            --primary: #00BFFF;       /* Cyber Blue */
            --accent: #FFD700;        /* Cyber Yellow */
            --danger: #ff2a2a;        /* War Red */
            --dark-bg: #050505;
            --glass: rgba(20, 25, 30, 0.85);
            --border-tech: 1px solid rgba(0, 191, 255, 0.3);
            
            /* Leagues */
            --bronze: #cd7f32; --silver: #c0c0c0; --gold: #FFD700; --diamond: #b9f2ff;
        }

        body {
            font-family: 'Exo 2', sans-serif;
            background-color: var(--dark-bg);
            color: #fff; margin: 0; padding: 0;
            display: flex; flex-direction: column; align-items: center;
            height: 100vh; overflow: hidden;
            user-select: none; -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* BACKGROUNDS */
        .bg-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 50% 50%, #0a1520, #000);
            z-index: -2;
        }
        .grid-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                linear-gradient(rgba(0, 191, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 191, 255, 0.03) 1px, transparent 1px);
            background-size: 20px 20px;
            z-index: -1; pointer-events: none;
        }

        /* LOADING SCREEN */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999; display: flex; flex-direction: column;
            justify-content: center; align-items: center; transition: opacity 0.5s;
        }
        .loader-bar { width: 200px; height: 4px; background: #333; margin-top: 20px; border-radius: 2px; overflow: hidden; }
        .loader-fill { width: 0%; height: 100%; background: var(--primary); transition: width 0.1s; }
        .blink { animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }

        /* HEADER & TICKER */
        .top-ui { width: 100%; max-width: 480px; padding: 10px; box-sizing: border-box; display: flex; justify-content: space-between; align-items: center; background: linear-gradient(180deg, rgba(0,0,0,0.9), transparent); }
        .news-ticker {
            width: 100%; background: rgba(0,0,0,0.8); color: var(--accent);
            font-size: 10px; white-space: nowrap; overflow: hidden; padding: 5px 0;
            border-bottom: 1px solid #333; font-family: 'Orbitron';
        }
        .ticker-content { display: inline-block; padding-left: 100%; animation: ticker 20s linear infinite; }
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }

        /* MAIN GAME AREA */
        .game-container {
            flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
            width: 100%; max-width: 480px; position: relative; padding-top: 10px;
        }

        .balance-box { text-align: center; margin-bottom: 20px; }
        .main-balance { font-size: 48px; font-weight: 900; font-family: 'Orbitron'; text-shadow: 0 0 20px rgba(0,191,255,0.3); }
        .league-badge { padding: 5px 12px; background: rgba(255,255,255,0.1); border-radius: 15px; font-size: 12px; border: 1px solid #444; cursor: pointer; }

        /* CLICKER BUTTON */
        .click-pad {
            width: 260px; height: 260px; border-radius: 50%;
            background: radial-gradient(circle, #152b3c, #000);
            border: 5px solid #333; box-shadow: 0 0 30px rgba(0,191,255,0.1);
            display: flex; justify-content: center; align-items: center;
            position: relative; cursor: pointer; transition: transform 0.05s;
            -webkit-touch-callout: none; user-select: none;
            margin: auto;
        }
        .click-pad:active { transform: scale(0.96); border-color: var(--primary); }
        .trident-icon { width: 60%; height: 60%; filter: drop-shadow(0 0 10px var(--primary)); pointer-events: none; }
        
        /* Effects */
        .effect-war { border-color: var(--danger) !important; box-shadow: 0 0 50px var(--danger), inset 0 0 20px var(--danger) !important; }
        .floating-text { position: absolute; font-weight: bold; font-size: 32px; pointer-events: none; animation: floatUp 0.8s forwards; z-index: 100; text-shadow: 0 0 5px #000; }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-100px); } }

        /* ENERGY & BOT */
        .bottom-panel { width: 90%; max-width: 420px; margin-bottom: 90px; }
        .energy-bar { width: 100%; height: 10px; background: #222; border-radius: 5px; overflow: hidden; margin-top: 10px; border: 1px solid #444; }
        .energy-fill { height: 100%; background: linear-gradient(90deg, var(--primary), #0055ff); width: 100%; transition: width 0.3s; }
        
        .bot-card {
            background: rgba(0, 191, 255, 0.1); border: 1px solid var(--primary);
            padding: 10px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px;
        }

        /* NAVIGATION */
        .nav-dock {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 94%; max-width: 460px; background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(10px); border-radius: 20px; border: 1px solid #333;
            display: flex; justify-content: space-around; padding: 12px 0; z-index: 500;
            box-shadow: 0 10px 40px #000;
        }
        .nav-item { background: none; border: none; color: #666; font-size: 10px; display: flex; flex-direction: column; align-items: center; width: 20%; cursor: pointer; }
        .nav-item.active { color: var(--primary); }
        .nav-icon { font-size: 22px; margin-bottom: 4px; }

        /* MODALS */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 1000; justify-content: center; align-items: flex-end; }
        .modal-body {
            background: #111; width: 100%; max-width: 500px; height: 85vh;
            border-radius: 25px 25px 0 0; padding: 20px; box-sizing: border-box;
            border-top: 2px solid var(--primary); overflow-y: auto; position: relative;
        }
        .close-btn { position: absolute; top: 20px; right: 20px; font-size: 24px; color: #666; cursor: pointer; }
        .list-item { 
            display: flex; justify-content: space-between; align-items: center; 
            background: #1a1a1a; padding: 15px; border-radius: 12px; 
            margin-bottom: 10px; border: 1px solid #333; 
        }
        .btn { background: var(--primary); color: #000; border: none; padding: 8px 16px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn:disabled { background: #333; color: #555; }
        
        /* Helper Classes */
        .text-tech { font-family: 'Orbitron'; letter-spacing: 1px; }
        .text-danger { color: var(--danger); }
        .text-accent { color: var(--accent); }
    </style>
</head>
<body>

    <div id="loader">
        <h2 class="text-tech" style="color:var(--primary)">CYBORG SYSTEM</h2>
        <div class="text-tech blink" style="font-size:12px; margin-top:10px;">ESTABLISHING UPLINK...</div>
        <div class="loader-bar"><div class="loader-fill" id="loadBar"></div></div>
    </div>

    <div class="bg-layer"></div>
    <div class="grid-overlay"></div>

    <div class="news-ticker">
        <div class="ticker-content">
            ‚ö° WAR UPDATE: ENEMY DRONE INTERCEPTED IN SUMY REGION ‚Ä¢ UCBG TOKEN LISTING CONFIRMED Q4 2025 ‚Ä¢ GENERAL STAFF: NEW DEFENSE LINES ESTABLISHED ‚Ä¢ JOIN THE SQUAD ‚Ä¢
        </div>
    </div>

    <div class="top-ui">
        <div style="display:flex; align-items:center; gap:8px;">
            <div style="width:30px; height:30px; background:#333; border-radius:50%; display:flex; justify-content:center; align-items:center;">üá∫üá¶</div>
            <span id="playerName" style="font-weight:bold; font-size:14px;">Recruit</span>
        </div>
        <div id="ton-connect"></div>
    </div>

    <div class="game-container">
        
        <div class="balance-box">
            <div style="font-size:12px; color:#aaa; margin-bottom:5px;">BALANCE (UCBG)</div>
            <div class="main-balance" id="displayBalance">0</div>
            <div class="league-badge" id="displayLeague" onclick="openModal('leagueModal')">ü•â Bronze League</div>
        </div>

        <div class="click-pad" id="clickerBtn">
            <svg class="trident-icon" viewBox="0 0 512 512">
                <defs>
                    <linearGradient id="grad1" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#00BFFF;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#FFD700;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <path fill="url(#grad1)" d="M256 32C242.7 32 232 42.7 232 56V192C232 222.9 206.9 248 176 248C145.1 248 120 222.9 120 192V88C120 74.7 109.3 64 96 64C82.7 64 72 74.7 72 88V192C72 249.4 118.6 296 176 296H200V424H152C138.7 424 128 434.7 128 448C128 461.3 138.7 472 152 472H360C373.3 472 384 461.3 384 448C384 434.7 373.3 424 360 424H312V296H336C393.4 296 440 249.4 440 192V88C440 74.7 429.3 64 416 64C402.7 64 392 74.7 392 88V192C392 222.9 366.9 248 336 248C305.1 248 280 222.9 280 192V56C280 42.7 269.3 32 256 32z"/>
            </svg>
            <div id="turboText" style="display:none; position:absolute; bottom:-30px; color:var(--danger); font-weight:900; letter-spacing:2px;">ROCKET MODE</div>
        </div>

    </div>

    <div class="bottom-panel">
        <div class="bot-card" id="botStatus" style="display:none;">
            <div style="display:flex; align-items:center; gap:10px;">
                <span style="font-size:24px;">ü§ñ</span>
                <div>
                    <div style="font-size:10px; color:#aaa;">AUTO-DEFENSE</div>
                    <div style="font-family:monospace; font-weight:bold;" id="botTimer">--:--:--</div>
                </div>
            </div>
            <button class="btn" onclick="claimBot()">CLAIM</button>
        </div>

        <div style="display:flex; justify-content:space-between; font-size:12px; color:#aaa;">
            <span>‚ö° Energy</span>
            <span><span id="enVal">1000</span> / <span id="enMax">1000</span></span>
        </div>
        <div class="energy-bar"><div class="energy-fill" id="enFill"></div></div>
    </div>

    <div class="nav-dock">
        <button class="nav-item active" onclick="closeModals()"><div class="nav-icon">üè†</div>Base</button>
        <button class="nav-item" onclick="openModal('upgModal')"><div class="nav-icon">üõ†</div>Upgrade</button>
        <button class="nav-item" onclick="openModal('warModal')"><div class="nav-icon">‚öîÔ∏è</div>Map</button>
        <button class="nav-item" onclick="openModal('tasksModal')"><div class="nav-icon">üìã</div>Tasks</button>
        <button class="nav-item" onclick="openModal('shopModal')"><div class="nav-icon">üíé</div>Shop</button>
    </div>

    <div id="upgModal" class="modal-overlay">
        <div class="modal-body">
            <span class="close-btn" onclick="closeModals()">&times;</span>
            <h2 class="text-tech">ARSENAL</h2>
            <div id="upgradeList"></div>
        </div>
    </div>

    <div id="warModal" class="modal-overlay">
        <div class="modal-body">
            <span class="close-btn" onclick="closeModals()">&times;</span>
            <h2 class="text-tech text-danger">WAR MAP</h2>
            <div style="background:#222; height:150px; border-radius:10px; display:flex; align-items:center; justify-content:center; margin-bottom:15px; border:1px dashed #555;">
                <span style="color:#555;">MAP VISUALIZATION OFFLINE</span>
            </div>
            
            <div class="list-item" style="border-color:var(--danger)">
                <div>
                    <div style="font-weight:bold; color:var(--danger)">LAUNCH ROCKET</div>
                    <div style="font-size:10px;">x10 CLICK POWER (10 sec)</div>
                </div>
                <button class="btn" style="background:var(--danger)" onclick="activateTurbo()">LAUNCH</button>
            </div>

            <div class="list-item">
                <div>
                    <div style="font-weight:bold;">PvE: Drone Sortie</div>
                    <div style="font-size:10px;">Cost: 1000 Energy</div>
                </div>
                <button class="btn" onclick="doPve()">START</button>
            </div>
        </div>
    </div>

    <div id="tasksModal" class="modal-overlay">
        <div class="modal-body">
            <span class="close-btn" onclick="closeModals()">&times;</span>
            <h2 class="text-tech text-accent">MISSIONS</h2>
            <div class="list-item">
                <div>
                    <div style="font-weight:bold;">Invite Ally</div>
                    <div style="font-size:10px; color:#aaa;">+50,000 UCBG</div>
                </div>
                <button class="btn" onclick="alert('Invite link copied!')">COPY</button>
            </div>
            <div class="list-item">
                <div>
                    <div style="font-weight:bold;">Subscribe Channel</div>
                    <div style="font-size:10px; color:#aaa;">+10,000 UCBG</div>
                </div>
                <button class="btn">GO</button>
            </div>
        </div>
    </div>

    <div id="shopModal" class="modal-overlay">
        <div class="modal-body">
            <span class="close-btn" onclick="closeModals()">&times;</span>
            <h2 class="text-tech" style="color:#0088cc">DONATIONS (TON)</h2>
            <div class="list-item">
                <div>
                    <div style="font-weight:bold;">VIP SUPPLIES</div>
                    <div style="font-size:10px;">1,000,000 UCBG</div>
                </div>
                <button class="btn" style="background:#0088cc; color:#fff;" onclick="fakeBuy()">1 TON</button>
            </div>
            <p style="text-align:center; font-size:10px; color:#555; margin-top:20px;">
                Funds support the developer & emulation server.
            </p>
        </div>
    </div>

    <script>
        // --- GAME SYSTEM ---
        const TG = window.Telegram.WebApp;
        TG.expand(); TG.setHeaderColor('#050505');

        // State
        let game = {
            bal: 0,
            energy: 1000,
            league: 0,
            hasBot: false,
            botStart: 0,
            turboEnd: 0,
            upgrades: {
                tap: { lvl: 1, base: 500, val: 1 },
                eng: { lvl: 1, base: 500, val: 1000 },
                reg: { lvl: 1, base: 1000, val: 2 }
            }
        };

        const LEAGUES = [
            { n: "Bronze", lim: 0, c: "#cd7f32" },
            { n: "Silver", lim: 50000, c: "#c0c0c0" },
            { n: "Gold", lim: 500000, c: "#FFD700" },
            { n: "Diamond", lim: 2000000, c: "#b9f2ff" }
        ];

        // --- INIT ---
        window.onload = function() {
            // Fake Loader Logic
            let bar = document.getElementById('loadBar');
            let w = 0;
            let int = setInterval(() => {
                w += Math.random() * 10;
                if(w > 100) w = 100;
                bar.style.width = w + '%';
                if(w === 100) {
                    clearInterval(int);
                    setTimeout(() => {
                        document.getElementById('loader').style.opacity = '0';
                        setTimeout(()=>document.getElementById('loader').style.display='none', 500);
                    }, 500);
                }
            }, 100);

            // Load Data
            let save = localStorage.getItem('cyborg_v5_save');
            if(save) game = {...game, ...JSON.parse(save)};

            if(TG.initDataUnsafe.user) {
                document.getElementById('playerName').innerText = TG.initDataUnsafe.user.first_name;
            }

            // Render
            updateUI();
            renderUpgrades();
            
            // Loop
            setInterval(() => {
                if(game.energy < game.upgrades.eng.val) {
                    game.energy = Math.min(game.upgrades.eng.val, game.energy + game.upgrades.reg.val);
                    updateUI();
                }
                checkBot();
            }, 1000);

            // TON UI
            new TON_CONNECT_UI.TonConnectUI({
                manifestUrl: 'https://raw.githubusercontent.com/ton-community/tutorials/main/03-client/test/public/tonconnect-manifest.json',
                buttonRootId: 'ton-connect'
            });
        };

        // --- CORE LOGIC ---
        const btn = document.getElementById('clickerBtn');
        
        btn.addEventListener('pointerdown', (e) => {
            if(game.energy >= 1) {
                // Calc Damage
                let mult = (Date.now() < game.turboEnd) ? 10 : 1;
                let dmg = (game.upgrades.tap.val + game.upgrades.tap.lvl) * mult;
                
                // Update
                game.energy -= 1;
                game.bal += dmg;
                
                // FX
                createFloat(e.clientX, e.clientY, `+${dmg}`, mult > 1);
                btn.style.transform = "scale(0.96)";
                setTimeout(()=>btn.style.transform="scale(1)", 80);
                
                if(TG.HapticFeedback) TG.HapticFeedback.impactOccurred(mult > 1 ? 'heavy' : 'light');

                checkLeague();
                updateUI();
                save();
            }
        });

        function createFloat(x, y, txt, isCrit) {
            let el = document.createElement('div');
            el.className = 'floating-text';
            el.innerText = txt;
            el.style.left = (x - 20) + 'px';
            el.style.top = (y - 50) + 'px';
            if(isCrit) el.style.color = 'var(--danger)';
            else el.style.color = '#fff';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 800);
        }

        // --- UPGRADES ---
        function renderUpgrades() {
            const list = document.getElementById('upgradeList');
            list.innerHTML = '';

            // Bot Item
            list.innerHTML += `
            <div class="list-item" style="border-color:var(--primary)">
                <div><div style="font-weight:bold;">AUTO-DEFENSE BOT</div><div style="font-size:10px;">Farms 4 hours offline</div></div>
                <button class="btn" onclick="buyBot()" ${game.hasBot?'disabled':''}>50k</button>
            </div>`;

            // Standard Items
            const items = [
                {id:'tap', n:'Cyber Fist', d:'+Damage'},
                {id:'eng', n:'Battery Pack', d:'+Max Energy'},
                {id:'reg', n:'Solar Charger', d:'+Regen Speed'}
            ];

            items.forEach(i => {
                let u = game.upgrades[i.id];
                let cost = Math.floor(u.base * Math.pow(1.6, u.lvl));
                list.innerHTML += `
                <div class="list-item">
                    <div>
                        <div style="font-weight:bold;">${i.n} <span style="color:var(--primary)">Lvl ${u.lvl}</span></div>
                        <div style="font-size:10px; color:#888;">${i.d}</div>
                    </div>
                    <button class="btn" onclick="buy('${i.id}', ${cost})">${abbr(cost)}</button>
                </div>`;
            });
        }

        window.buy = (id, cost) => {
            if(game.bal >= cost) {
                game.bal -= cost;
                game.upgrades[id].lvl++;
                if(id === 'eng') game.upgrades.eng.val += 500;
                if(id === 'reg') game.upgrades.reg.val += 2;
                if(id === 'tap') game.upgrades.tap.val += 2;
                renderUpgrades(); updateUI(); save();
            }
        };

        window.buyBot = () => {
            if(game.bal >= 50000 && !game.hasBot) {
                game.bal -= 50000;
                game.hasBot = true;
                game.botStart = Date.now();
                renderUpgrades(); updateUI(); save();
            }
        };

        window.activateTurbo = () => {
            if(Date.now() < game.turboEnd) return;
            game.turboEnd = Date.now() + 10000;
            closeModals(); updateUI();
        };

        window.doPve = () => {
            if(game.energy >= 1000) {
                game.energy -= 1000;
                game.bal += 5000;
                TG.showAlert("üí• Target Destroyed! +5000 UCBG");
                updateUI();
            } else {
                TG.showAlert("Not enough energy!");
            }
        }

        window.fakeBuy = () => {
            TG.showConfirm("Send 1 TON?", (ok) => {
                if(ok) {
                    setTimeout(() => {
                        game.bal += 1000000;
                        TG.showAlert("Payment Successful! +1M UCBG");
                        updateUI();
                    }, 1000);
                }
            });
        }

        // --- UTILS ---
        function checkLeague() {
            let nxt = game.league + 1;
            if(nxt < LEAGUES.length && game.bal >= LEAGUES[nxt].lim) {
                game.league = nxt;
                TG.showAlert(`üèÜ Promoted to ${LEAGUES[nxt].n} League!`);
            }
        }

        function checkBot() {
            if(!game.hasBot) return;
            document.getElementById('botStatus').style.display = 'flex';
            let diff = Date.now() - game.botStart;
            let max = 4 * 3600 * 1000;
            
            if(diff >= max) {
                document.getElementById('botTimer').innerText = "FULL";
                document.getElementById('botTimer').style.color = "#0f0";
            } else {
                let left = max - diff;
                let h = Math.floor(left/3600000);
                let m = Math.floor((left%3600000)/60000);
                document.getElementById('botTimer').innerText = `${h}h ${m}m`;
            }
        }
        
        window.claimBot = () => {
            game.bal += 20000; 
            game.botStart = Date.now(); 
            updateUI(); save();
        };

        function updateUI() {
            // Balance
            document.getElementById('displayBalance').innerText = game.bal.toLocaleString();
            
            // Energy
            let cur = Math.floor(game.energy);
            let max = game.upgrades.eng.val;
            document.getElementById('enVal').innerText = cur;
            document.getElementById('enMax').innerText = max;
            document.getElementById('enFill').style.width = (cur/max*100) + "%";
            
            // League
            let lg = LEAGUES[game.league];
            let b = document.getElementById('displayLeague');
            b.innerText = `üèÜ ${lg.n} League`;
            b.style.color = lg.c;
            
            // Turbo
            if(Date.now() < game.turboEnd) {
                btn.classList.add('effect-war');
                document.getElementById('turboText').style.display = 'block';
            } else {
                btn.classList.remove('effect-war');
                document.getElementById('turboText').style.display = 'none';
            }
        }

        function save() { localStorage.setItem('cyborg_v5_save', JSON.stringify(game)); }
        function abbr(n) { return n > 1000000 ? (n/1000000).toFixed(1)+'M' : (n > 1000 ? (n/1000).toFixed(1)+'k' : n); }
        
        window.openModal = (id) => document.getElementById(id).style.display = 'flex';
        window.closeModals = () => document.querySelectorAll('.modal-overlay').forEach(el => el.style.display = 'none');
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ukrainian Cyborgs v1.6 (Staking)</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        /* --- –°–¢–ò–õ–Ü (v1.5 BASE) --- */
        :root {
            --primary: #00BFFF;
            --accent: #FFD700;
            --bronze: #cd7f32;
            --silver: #c0c0c0;
            --gold: #FFD700;
            --diamond: #b9f2ff;
            --bg-dark: #050505;
            --danger: #ff3b30;
            --success: #00ff88;
        }

        body {
            font-family: 'Courier New', monospace;
            background-color: var(--bg-dark);
            color: #fff; margin: 0; padding: 0;
            display: flex; flex-direction: column; align-items: center;
            height: 100vh; overflow: hidden;
            user-select: none; -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 90px;
        }

        /* FIX: TON CONNECT LAYER */
        #tc-widget-root, tc-root, .tc-root { z-index: 10000 !important; position: relative; }
        .modal { z-index: 2000; } 

        .bg-fx {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 50% 50%, #112, #000);
            z-index: -2;
        }

        .top-bar {
            width: 100%; max-width: 420px; padding: 10px 15px; 
            display: flex; justify-content: space-between; align-items: center;
            box-sizing: border-box;
        }
        .settings-icon { font-size: 24px; cursor: pointer; opacity: 0.7; }

        .container { width: 100%; max-width: 420px; padding: 0 15px; box-sizing: border-box; text-align: center; z-index: 1; flex-grow: 1; display: flex; flex-direction: column; }

        h1 { font-family: sans-serif; font-size: 20px; color: var(--accent); text-transform: uppercase; letter-spacing: 2px; margin: 0; text-shadow: 0 0 10px var(--accent); }

        .balance-val { font-size: 46px; font-weight: 800; font-family: sans-serif; text-shadow: 0 0 15px var(--primary); margin-top: 10px; }
        
        .league-badge {
            display: inline-block; padding: 4px 12px; border-radius: 12px;
            background: rgba(255,255,255,0.1); border: 1px solid #444;
            font-size: 12px; font-weight: bold; margin-top: 5px; color: #ccc;
            transition: all 0.3s ease;
        }

        .clicker-area {
            flex-grow: 1; display: flex; justify-content: center; align-items: center;
            margin: 10px 0; position: relative; width: 100%;
        }
        .main-btn {
            width: 75vw; height: 75vw; max-width: 290px; max-height: 290px;
            border-radius: 50%;
            background: radial-gradient(circle, #152b3c, #000);
            border: 3px solid #333;
            box-shadow: 0 0 30px rgba(0, 191, 255, 0.1);
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; position: relative; overflow: hidden;
            transition: transform 0.05s, box-shadow 0.3s;
            -webkit-touch-callout: none;
        }
        
        .main-btn.anim-active:active { transform: scale(0.96); border-color: var(--accent); }
        .diamond-mode {
            box-shadow: 0 0 50px var(--diamond), inset 0 0 20px var(--diamond) !important;
            border-color: var(--diamond) !important;
            animation: diamondPulse 2s infinite;
        }

        .trident-svg { width: 70%; height: 70%; filter: drop-shadow(0 0 15px var(--primary)); pointer-events: none; }
        .trident-anim { animation: breathe 3s infinite ease-in-out; }
        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.03); } }

        .energy-bar {
            width: 100%; height: 10px; background: #222; border-radius: 5px;
            overflow: hidden; margin-top: auto; margin-bottom: 5px; border: 1px solid #444;
        }
        .energy-fill { height: 100%; background: linear-gradient(90deg, var(--primary), #0055ff); width: 100%; transition: width 0.3s; }
        .energy-info { display: flex; justify-content: space-between; font-size: 12px; color: #ccc; margin-bottom: 15px; font-family: sans-serif; }

        .bot-panel {
            background: rgba(0, 191, 255, 0.15); border: 1px solid var(--primary);
            border-radius: 12px; padding: 10px 15px; margin-bottom: 15px;
            display: none; justify-content: space-between; align-items: center;
        }

        .floating-txt {
            position: absolute; color: #fff; font-weight: 900; font-size: 36px;
            text-shadow: 0 0 10px var(--primary), 0 0 20px var(--primary);
            pointer-events: none; z-index: 1000;
            animation: floatUp 0.6s ease-out forwards;
        }
        @keyframes floatUp { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-100px) scale(1.5); opacity: 0; } }

        .nav-bar {
            position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%);
            width: 96%; max-width: 400px; background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(10px); border-radius: 20px; border: 1px solid #333;
            display: flex; justify-content: space-around; padding: 10px 5px; z-index: 100;
        }
        .nav-btn { background: none; border: none; color: #666; font-size: 9px; display: flex; flex-direction: column; align-items: center; cursor: pointer; flex: 1; }
        .nav-btn.active { color: var(--accent); }
        .nav-icon { font-size: 20px; margin-bottom: 4px; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; justify-content: center; align-items: flex-end; }
        .modal-card { background: #111; width: 100%; max-width: 500px; border-radius: 25px 25px 0 0; padding: 25px; max-height: 80vh; overflow-y: auto; border-top: 2px solid var(--primary); color: #fff; box-sizing: border-box; }
        .close-btn { position: absolute; top: 20px; right: 20px; font-size: 24px; color: #666; cursor: pointer; }
        
        .upg-row { display: flex; justify-content: space-between; align-items: center; background: #1a1a1a; padding: 15px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #333; }
        .btn { background: var(--primary); color: #000; border: none; padding: 8px 16px; border-radius: 8px; font-weight: bold; font-size: 12px; cursor: pointer; }
        .btn:disabled { background: #333; color: #555; }
        
        .switch { position: relative; display: inline-block; width: 50px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #333; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* Airdrop Box */
        .airdrop-box { background: rgba(0, 191, 255, 0.1); border: 1px solid var(--primary); padding: 15px; border-radius: 12px; margin-top: 20px; text-align: center; }
        .timer-digits { font-size: 24px; font-weight: bold; color: var(--accent); font-family: monospace; margin-top: 5px; }

        /* Staking Card */
        .staking-card { border: 1px solid #333; border-radius: 10px; padding: 15px; margin-bottom: 10px; background: rgba(255,255,255,0.03); }
        .staking-active { border-color: var(--success); box-shadow: 0 0 10px rgba(0,255,136,0.1); }
        
        /* Friends List */
        .friend-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #222; font-size: 12px; }
        .friend-name { color: var(--primary); }

    </style>
</head>
<body>

    <div class="bg-fx"></div>

    <div class="top-bar">
        <div></div>
        <div class="settings-icon" onclick="openModal('settingsModal')">‚öôÔ∏è</div>
    </div>

    <div class="container">
        <h1 id="ui_title">UKRAINIAN CYBORGS</h1>

        <div>
            <div class="balance-val" id="displayBalance">0</div>
            <div class="league-badge" id="leagueDisplay">Bronze League</div>
        </div>

        <div class="bot-panel" id="botPanel">
            <div style="display:flex; align-items:center; gap:10px;">
                <span style="font-size:24px;">ü§ñ</span>
                <div style="text-align:left;">
                    <div style="font-size:12px; color:#aaa;" id="txt_bot_stat">–ê–≤—Ç–æ-–ë–æ—Ç</div>
                    <div style="font-family:monospace; font-weight:bold;" id="botTimer">04:00:00</div>
                </div>
            </div>
            <button class="btn" id="claimBotBtn" onclick="claimBot()">CLAIM</button>
        </div>

        <div class="clicker-area">
            <div class="main-btn" id="tapBtn">
                <svg class="trident-svg trident-anim" viewBox="0 0 512 512">
                    <defs>
                        <linearGradient id="grad1" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#00BFFF;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#FFD700;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <path fill="url(#grad1)" d="M256 32C242.7 32 232 42.7 232 56V192C232 222.9 206.9 248 176 248C145.1 248 120 222.9 120 192V88C120 74.7 109.3 64 96 64C82.7 64 72 74.7 72 88V192C72 249.4 118.6 296 176 296H200V424H152C138.7 424 128 434.7 128 448C128 461.3 138.7 472 152 472H360C373.3 472 384 461.3 384 448C384 434.7 373.3 424 360 424H312V296H336C393.4 296 440 249.4 440 192V88C440 74.7 429.3 64 416 64C402.7 64 392 74.7 392 88V192C392 222.9 366.9 248 336 248C305.1 248 280 222.9 280 192V56C280 42.7 269.3 32 256 32z"/>
                </svg>
            </div>
            <div id="turboTimer" style="display:none; position:absolute; bottom:-30px; color:#ff3b30; font-weight:bold;"></div>
        </div>

        <div class="energy-bar"><div class="energy-fill" id="energyFill"></div></div>
        <div class="energy-info">
            <span>‚ö° <span id="enVal">1000</span> / <span id="enMax">1000</span></span>
            <span id="regenState" style="color:var(--primary); display:none;">Charging...</span>
        </div>
    </div>

    <div class="nav-bar">
        <button class="nav-btn active" onclick="closeModals()"><div class="nav-icon">üè†</div>Base</button>
        <button class="nav-btn" onclick="openModal('tasksModal')"><div class="nav-icon">üì°</div>Tasks</button>
        <button class="nav-btn" onclick="openModal('upgModal')"><div class="nav-icon">üõ†</div>Upg</button>
        <button class="nav-btn" onclick="openModal('friendsModal')"><div class="nav-icon">üë•</div>Team</button>
        <button class="nav-btn" onclick="openModal('walletModal')"><div class="nav-icon">üíé</div>Invest</button>
    </div>

    <div id="upgModal" class="modal">
        <div class="modal-card">
            <span class="close-btn" onclick="closeModals()">&times;</span>
            <h2>–ê–†–°–ï–ù–ê–õ</h2>
            <div class="upg-row" style="border-color:var(--accent);">
                <div>
                    <div style="font-size:14px; font-weight:bold; color:var(--accent);">ü§ñ –ê–≤—Ç–æ-–ë–æ—Ç</div>
                    <div style="font-size:10px; color:#888;">–ó–±–∏—Ä–∞—î –ø–æ–∫–∏ —Ç–∏ –æ—Ñ–ª–∞–π–Ω (4 –≥–æ–¥)</div>
                </div>
                <button class="btn" id="buyBotBtn" onclick="buyBot()">50,000</button>
            </div>
            <div class="upg-row" style="border-color:var(--danger);">
                <div>
                    <div style="font-size:14px; font-weight:bold; color:var(--danger);">üöÄ –†–∞–∫–µ—Ç–∞ (x10)</div>
                    <div style="font-size:10px; color:#888;">–ë—É—Å—Ç –Ω–∞ 10 —Å–µ–∫—É–Ω–¥</div>
                </div>
                <button class="btn" style="background:var(--danger); color:#fff;" onclick="activateRocket()">START</button>
            </div>
            <hr style="border-color:#333; margin:15px 0;">
            <div id="upgradesList"></div>
        </div>
    </div>

    <div id="tasksModal" class="modal">
        <div class="modal-card">
            <span class="close-btn" onclick="closeModals()">&times;</span>
            <h2>–°–ü–ï–¶ –ó–ê–í–î–ê–ù–ù–Ø</h2>
            <div class="upg-row">
                <div>
                    <div style="font-size:14px; font-weight:bold;">–ö–∞–Ω–∞–ª UCBG</div>
                    <div style="font-size:10px; color:#888;">+1,000,000 –ú–æ–Ω–µ—Ç</div>
                </div>
                <button class="btn" id="task1Btn" onclick="checkTask('task1', 'https://t.me/ucbgcoin')">Go</button>
            </div>
            <div class="upg-row">
                <div>
                    <div style="font-size:14px; font-weight:bold;">–ß–∞—Ç –ö—ñ–±–æ—Ä–≥—ñ–≤</div>
                    <div style="font-size:10px; color:#888;">+1,000,000 –ú–æ–Ω–µ—Ç</div>
                </div>
                <button class="btn" id="task2Btn" onclick="checkTask('task2', 'https://t.me/ukrainian_cyborgs_ton')">Go</button>
            </div>
        </div>
    </div>

    <div id="friendsModal" class="modal">
        <div class="modal-card">
            <span class="close-btn" onclick="closeModals()">&times;</span>
            <h2>–®–¢–ê–ë</h2>
            <div style="background:#1a1a1a; padding:15px; border-radius:10px; margin:10px 0; border:1px solid #333;">
                <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                    <span>–¢–æ–±—ñ:</span> <span style="color:var(--primary); font-weight:bold;">+500,000</span>
                </div>
                <div style="display:flex; justify-content:space-between;">
                    <span>–î—Ä—É–≥—É:</span> <span style="color:var(--accent); font-weight:bold;">+250,000</span>
                </div>
            </div>
            <button class="btn" style="width:100%; margin-bottom:20px;" onclick="invite()">–ó–ê–ü–†–û–°–ò–¢–ò –ë–Ü–ô–¶–Ø</button>
            
            <h3 style="font-size:14px; color:#888; border-bottom:1px solid #333; padding-bottom:5px;">–°–ü–ò–°–û–ö –ö–û–ú–ê–ù–î–ò</h3>
            <div id="friendsList" style="max-height: 200px; overflow-y: auto;">
                <div style="text-align:center; color:#555; font-size:12px; margin-top:10px;">–°–ø–∏—Å–æ–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π</div>
            </div>
        </div>
    </div>

    <div id="walletModal" class="modal">
        <div class="modal-card">
            <span class="close-btn" onclick="closeModals()">&times;</span>
            <h2>–§–Ü–ù–ê–ù–°–ò</h2>
            
            <div id="ton-btn" style="margin-bottom:20px; min-height: 50px;"></div>
            
            <div style="border:1px solid var(--accent); border-radius:10px; padding:10px; background:rgba(255, 215, 0, 0.05); margin-bottom:20px;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div style="font-size:12px; color:#aaa;">–ù–ê–ö–û–ü–ò–ß–ï–ù–û (STAKING)</div>
                    <button class="btn" onclick="harvestStaking()" style="padding:4px 10px; font-size:10px;">HARVEST</button>
                </div>
                <div id="stakingBalance" style="font-size:24px; color:var(--success); font-weight:bold; margin-top:5px;">0.00</div>
            </div>

            <h3 style="font-size:14px; margin-bottom:10px;">–ü–õ–ê–ù–ò –í–ö–õ–ê–î–Ü–í (TON)</h3>
            <div id="stakingOptions"></div>

            <hr style="border-color:#333; margin:20px 0;">
            
            <h3 style="font-size:16px; color:var(--primary);">NFT –í–ê–£–ß–ï–†–ò</h3>
            <div class="upg-row">
                <div>
                    <div style="font-size:14px; font-weight:bold;">–°—Ç–≤–æ—Ä–∏—Ç–∏ –í–∞—É—á–µ—Ä</div>
                    <div style="font-size:10px; color:#888;">–¶—ñ–Ω–∞: 1,000,000 –ú–æ–Ω–µ—Ç</div>
                </div>
                <button class="btn" onclick="mintVoucher()">–°–¢–í–û–†–ò–¢–ò</button>
            </div>
            <div style="text-align:center; font-size:12px; color:#aaa;">–í–∞—É—á–µ—Ä—ñ–≤: <span id="voucherCount" style="color:#fff;">0</span></div>

            <div class="airdrop-box">
                <div style="font-size:12px; color:#888;">AIRDROP TIMER</div>
                <div id="airdropTimer" class="timer-digits">--:--:--:--</div>
                <div style="font-size:10px; color:#555;">05.02.2026</div>
            </div>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-card">
            <span class="close-btn" onclick="closeModals()">&times;</span>
            <h2>–ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø</h2>
            <div class="upg-row" style="border-color:#555;">
                <div>
                    <div style="font-size:14px; font-weight:bold;">–ê–Ω—ñ–º–∞—Ü—ñ—ó</div>
                    <div style="font-size:10px; color:#888;">–ï—Ñ–µ–∫—Ç–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è</div>
                </div>
                <label class="switch">
                    <input type="checkbox" id="animToggle" onchange="toggleAnim()">
                    <span class="slider"></span>
                </label>
            </div>
            <div style="text-align:center; color:#555; font-size:10px; margin-top:20px;">Cyborg v1.6 (Staking)</div>
        </div>
    </div>

    <script>
        // --- CORE ---
        const TG = window.Telegram.WebApp;
        TG.expand(); TG.setHeaderColor('#050505');

        // UI Refs
        const elBalance = document.getElementById('displayBalance');
        const elEnergyFill = document.getElementById('energyFill');
        const elEnVal = document.getElementById('enVal');
        const elEnMax = document.getElementById('enMax');
        const elRegenState = document.getElementById('regenState');
        const elBotPanel = document.getElementById('botPanel');
        const elBotTimer = document.getElementById('botTimer');
        const elClaimBtn = document.getElementById('claimBotBtn');
        const elTurbo = document.getElementById('turboTimer');
        const elTapBtn = document.getElementById('tapBtn');
        const elLeague = document.getElementById('leagueDisplay');

        // CONFIGS
        const LEAGUES = [
            { name: "Bronze", limit: 0, reward: 0, color: "var(--bronze)" },
            { name: "Silver", limit: 50000, reward: 5000, color: "var(--silver)" },
            { name: "Gold", limit: 500000, reward: 25000, color: "var(--gold)" },
            { name: "Diamond", limit: 10000000, reward: 100000, color: "var(--diamond)" }
        ];

        // 4 Levels of Staking from Task
        const STAKING_PLANS = [
            { id: 0, ton: 1, yieldDay: 50000 },
            { id: 1, ton: 10, yieldDay: 1000000 },
            { id: 2, ton: 100, yieldDay: 15000000 },
            { id: 3, ton: 1000, yieldDay: 50000000 }
        ];

        // STATE
        let game = {
            balance: 0,
            energy: 1000,
            leagueIndex: 0,
            vouchers: 0,
            
            // Staking State
            staking: {
                activePlan: -1, // -1 means none
                accumulated: 0,
                lastCalc: Date.now()
            },
            
            // Friends State
            friends: [], // Array of names

            hasPlayed: false,
            hasBot: false,
            botStartTime: 0,
            turboEnd: 0,
            clickCount: 0,
            tasks: { task1: false, task2: false },
            settings: { animations: true },
            upgrades: {
                tap: { lvl: 1, base: 500, factor: 2, val: 1 },
                eng: { lvl: 1, base: 500, factor: 2, val: 1000 },
                reg: { lvl: 1, base: 1000, factor: 2.5, val: 2 }
            }
        };

        // --- INIT ---
        function init() {
            loadGame();

            // Ref Logic
            const initData = TG.initDataUnsafe;
            if (!game.hasPlayed) {
                game.balance = 5000;
                if(initData && initData.start_param) {
                    game.balance += 250000; 
                    TG.showAlert("üéÅ –í–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ –±–æ–Ω—É—Å +250,000 –≤—ñ–¥ –¥—Ä—É–≥–∞!");
                }
                game.hasPlayed = true;
                saveGame();
            }

            // Timers
            setInterval(updateAirdropTimer, 1000);
            setInterval(calcStaking, 1000); // Staking Loop

            // Render
            updateUI();
            checkLeague(); 
            renderUpgrades();
            renderStaking();
            renderFriends();
            updateTasksUI();

            setInterval(() => { regenEnergy(); updateBot(); checkTurbo(); }, 1000);
            setInterval(() => { game.clickCount = 0; }, 2000);

            new TON_CONNECT_UI.TonConnectUI({
                manifestUrl: 'https://raw.githubusercontent.com/ton-community/tutorials/main/03-client/test/public/tonconnect-manifest.json',
                buttonRootId: 'ton-btn'
            });
        }

        // --- STAKING LOGIC ---
        function renderStaking() {
            const container = document.getElementById('stakingOptions');
            container.innerHTML = '';
            
            STAKING_PLANS.forEach(plan => {
                let isActive = (game.staking.activePlan === plan.id);
                let btnText = isActive ? "ACTIVE" : "STAKE";
                let btnClass = isActive ? "btn-action" : "btn";
                let styleClass = isActive ? "staking-card staking-active" : "staking-card";

                container.innerHTML += `
                <div class="${styleClass}">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <div style="font-weight:bold; font-size:14px;">${plan.ton} TON</div>
                            <div style="font-size:10px; color:#0f0;">+${(plan.yieldDay).toLocaleString()} / –¥–µ–Ω—å</div>
                        </div>
                        <button class="${btnClass}" onclick="activateStaking(${plan.id})" ${isActive ? 'disabled' : ''}>${btnText}</button>
                    </div>
                </div>`;
            });
        }

        window.activateStaking = (id) => {
            // In real app -> Smart Contract Call. Here -> Simulation.
            TG.showConfirm(`–ó–∞–º–æ—Ä–æ–∑–∏—Ç–∏ ${STAKING_PLANS[id].ton} TON –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ—Ö–æ–¥—É?`, (ok) => {
                if(ok) {
                    game.staking.activePlan = id;
                    game.staking.lastCalc = Date.now();
                    TG.showAlert("‚úÖ –°—Ç–µ–π–∫—ñ–Ω–≥ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ! –î–æ—Ö—ñ–¥ –ø–æ—á–∞–≤ –Ω–∞—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏—Å—å.");
                    renderStaking();
                    saveGame();
                }
            });
        };

        function calcStaking() {
            if(game.staking.activePlan === -1) return;
            
            let now = Date.now();
            let plan = STAKING_PLANS[game.staking.activePlan];
            
            // Yield per second = YieldDay / 86400
            let yieldPerSec = plan.yieldDay / 86400;
            let seconds passed = (now - game.staking.lastCalc) / 1000; // Oops, variable name fix needed
            
            // Simple approach: Add yield every second in this loop is easier for display
            // But for precision we use delta time.
            let delta = (now - game.staking.lastCalc) / 1000;
            
            if(delta >= 1) {
                let earned = yieldPerSec * delta;
                game.staking.accumulated += earned;
                game.staking.lastCalc = now;
                
                // Update UI
                document.getElementById('stakingBalance').innerText = Math.floor(game.staking.accumulated).toLocaleString();
                saveGame(); // Save progress
            }
        }

        window.harvestStaking = () => {
            if(game.staking.accumulated > 1) {
                let val = Math.floor(game.staking.accumulated);
                game.balance += val;
                game.staking.accumulated = 0;
                TG.showAlert(`üí∞ –ó—ñ–±—Ä–∞–Ω–æ ${val.toLocaleString()} –º–æ–Ω–µ—Ç!`);
                updateUI();
                saveGame();
                document.getElementById('stakingBalance').innerText = "0.00";
            } else {
                TG.showAlert("–©–µ –Ω—ñ—á–æ–≥–æ –∑–±–∏—Ä–∞—Ç–∏.");
            }
        };

        // --- FRIENDS LIST ---
        window.invite = () => {
            const userId = TG.initDataUnsafe?.user?.id || "user";
            const botLink = `https://t.me/ucbgcoin_bot/Ucbgcoin?startapp=${userId}`;
            const text = "–û—Ç—Ä–∏–º–∞–π +250k –º–æ–Ω–µ—Ç –≤ Ukrainian Cyborgs! ü¶æüá∫üá¶";
            const fullUrl = `https://t.me/share/url?url=${encodeURIComponent(botLink)}&text=${encodeURIComponent(text)}`;
            
            TG.openTelegramLink(fullUrl);

            // Simulation for UX
            setTimeout(() => {
                let fakeNames = ["Cyborg_User", "Neo_Soldier", "UA_Phantom", "Stalker_77"];
                let randName = fakeNames[Math.floor(Math.random()*fakeNames.length)] + "_" + Math.floor(Math.random()*100);
                
                // Add fake friend if list is small (just for demo)
                if(game.friends.length < 5) {
                    game.friends.push(randName);
                    game.balance += 500000;
                    TG.showAlert(`–ù–æ–≤–∏–π —Ä–µ—Ñ–µ—Ä–∞–ª: ${randName}\n+500,000 –º–æ–Ω–µ—Ç!`);
                    renderFriends();
                    saveGame();
                    updateUI();
                }
            }, 5000); // Simulate friend joining after 5 sec
        };

        function renderFriends() {
            const list = document.getElementById('friendsList');
            if(game.friends && game.friends.length > 0) {
                list.innerHTML = '';
                game.friends.forEach(name => {
                    list.innerHTML += `
                    <div class="friend-item">
                        <span class="friend-name">üë§ ${name}</span>
                        <span style="color:#888;">+500k</span>
                    </div>`;
                });
            } else {
                list.innerHTML = '<div style="text-align:center; color:#555; font-size:12px; margin-top:10px;">–°–ø–∏—Å–æ–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π</div>';
            }
        }

        // --- GAMEPLAY & NFT ---

        elTapBtn.addEventListener('pointerdown', (e) => {
            e.preventDefault();
            if(game.clickCount > 35) return; 
            
            let power = game.upgrades.tap.val + (game.upgrades.tap.lvl - 1);
            if (Date.now() < game.turboEnd) power *= 10;

            if (game.energy >= power) {
                game.balance += power;
                game.energy -= power;
                game.clickCount++;
                
                if(TG.HapticFeedback) TG.HapticFeedback.impactOccurred('light');
                if(game.settings.animations) {
                    elTapBtn.style.transform = "scale(0.97)";
                    setTimeout(() => elTapBtn.style.transform = "scale(1)", 80);
                    showFloatingText(e.clientX, e.clientY, `+${power}`);
                }

                updateUI(); checkLeague(); saveGame();
            }
        });

        function showFloatingText(x, y, txt) {
            let el = document.createElement('div');
            el.className = 'floating-txt';
            el.textContent = txt;
            el.style.left = (x - 20) + 'px';
            el.style.top = (y - 40) + 'px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 600);
        }

        function checkLeague() {
            let next = game.leagueIndex + 1;
            if (next < LEAGUES.length && game.balance >= LEAGUES[next].limit) {
                game.leagueIndex = next;
                game.balance += LEAGUES[next].reward;
                TG.showAlert(`üèÜ Rank Up! ${LEAGUES[next].name}`);
                updateUI();
            }
        }

        // --- TASKS ---
        window.checkTask = (taskId, url) => {
            if(game.tasks && game.tasks[taskId]) return;
            TG.openTelegramLink(url);
            setTimeout(() => {
                TG.showConfirm("–í–∏ –ø—ñ–¥–ø–∏—Å–∞–ª–∏—Å—è?", (ok) => {
                    if(ok) {
                        game.tasks[taskId] = true;
                        game.balance += 1000000;
                        updateTasksUI(); saveGame(); updateUI();
                    }
                });
            }, 3000);
        };
        function updateTasksUI() {
            if(game.tasks?.task1) { document.getElementById('task1Btn').textContent = "DONE"; document.getElementById('task1Btn').disabled = true; }
            if(game.tasks?.task2) { document.getElementById('task2Btn').textContent = "DONE"; document.getElementById('task2Btn').disabled = true; }
        }

        // --- NFT ---
        window.mintVoucher = () => {
            const price = 1000000;
            if(game.balance >= price) {
                game.balance -= price;
                game.vouchers = (game.vouchers || 0) + 1;
                TG.showAlert("‚úÖ –í–∞—É—á–µ—Ä —Å—Ç–≤–æ—Ä–µ–Ω–æ!");
                updateUI(); saveGame();
            } else {
                TG.showAlert(`‚ùå –¢—Ä–µ–±–∞ ${price.toLocaleString()} –º–æ–Ω–µ—Ç.`);
            }
        };

        // --- UTILS ---
        function updateAirdropTimer() {
            const target = new Date('2026-02-05T00:00:00').getTime();
            const now = new Date().getTime();
            const diff = target - now;
            if (diff > 0) {
                const d = Math.floor(diff / 86400000);
                const h = Math.floor((diff % 86400000) / 3600000);
                const m = Math.floor((diff % 3600000) / 60000);
                const s = Math.floor((diff % 60000) / 1000);
                document.getElementById('airdropTimer').innerText = `${d}d ${h}h ${m}m ${s}s`;
            } else {
                document.getElementById('airdropTimer').innerText = "AIRDROP LIVE";
            }
        }

        function renderUpgrades() {
            const list = document.getElementById('upgradesList');
            list.innerHTML = '';
            const items = [
                { id: 'tap', name: "–ú—É–ª—å—Ç–∏—Ç–∞–ø (+1)", desc: "–°–∏–ª–∞ —É–¥–∞—Ä—É" },
                { id: 'eng', name: "–ï–Ω–µ—Ä–≥—ñ—è (+500)", desc: "–û–±'—î–º –±–∞–∫—É" },
                { id: 'reg', name: "–®–≤–∏–¥–∫—ñ—Å—Ç—å (+2)", desc: "–í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è" }
            ];
            items.forEach(i => {
                let u = game.upgrades[i.id];
                let cost = Math.floor(u.base * Math.pow(u.factor, u.lvl - 1));
                list.innerHTML += `
                <div class="upg-row">
                    <div>
                        <div style="font-size:14px; font-weight:bold;">${i.name} <span style="color:var(--primary)">Lvl ${u.lvl}</span></div>
                        <div style="font-size:10px; color:#888;">${i.desc}</div>
                    </div>
                    <button class="btn" onclick="buy('${i.id}', ${cost})" ${game.balance < cost ? 'disabled' : ''}>${cost.toLocaleString()}</button>
                </div>`;
            });
        }

        window.buy = (id, cost) => {
            if(game.balance >= cost) {
                game.balance -= cost;
                game.upgrades[id].lvl++;
                if(id === 'eng') game.upgrades.eng.val += 500;
                if(id === 'reg') game.upgrades.reg.val += 2;
                updateUI(); renderUpgrades(); saveGame();
            }
        };

        // ... Bot & Rocket logic same as before ...
        window.buyBot = () => { if(game.balance >= 50000 && !game.hasBot) { game.balance-=50000; game.hasBot=true; game.botStartTime=Date.now(); updateUI(); saveGame(); }};
        window.claimBot = () => { game.balance+=10000; game.botStartTime=Date.now(); TG.showAlert("ü§ñ Collected!"); updateUI(); saveGame(); };
        function updateBot() { 
            if(!game.hasBot) { elBotPanel.style.display='none'; return; }
            elBotPanel.style.display='flex'; document.getElementById('buyBotBtn').textContent="OWNED"; document.getElementById('buyBotBtn').disabled=true;
            const diff = Date.now()-game.botStartTime; 
            if(diff>14400000) { elBotTimer.textContent="READY"; elBotTimer.style.color="#0f0"; elClaimBtn.disabled=false; }
            else { 
                let left=14400000-diff; let h=Math.floor(left/3600000); let m=Math.floor((left%3600000)/60000); let s=Math.floor((left%60000)/1000);
                elBotTimer.textContent=`${h}:${m}:${s}`; elBotTimer.style.color="#fff"; elClaimBtn.disabled=true;
            }
        }
        window.activateRocket = () => { if(Date.now() > game.turboEnd) { game.turboEnd=Date.now()+10000; closeModals(); updateUI(); }};
        function checkTurbo() { 
            if(Date.now()<game.turboEnd) { elTurbo.style.display='block'; elTurbo.textContent=`üî• ${Math.ceil((game.turboEnd-Date.now())/1000)}s`; elTapBtn.style.borderColor='var(--danger)'; }
            else { elTurbo.style.display='none'; elTapBtn.style.borderColor=(game.leagueIndex===3)?'var(--diamond)':'#333'; }
        }
        function regenEnergy() { if(game.energy < game.upgrades.eng.val) { game.energy = Math.min(game.upgrades.eng.val, game.energy + game.upgrades.reg.val); updateUI(); }}

        function updateUI() {
            elBalance.innerText = game.balance.toLocaleString();
            let cur = Math.floor(game.energy); let max = game.upgrades.eng.val;
            elEnVal.innerText = cur; elEnMax.innerText = max; elEnergyFill.style.width = (cur/max)*100+"%";
            elRegenState.style.display = (cur<max)?'block':'none';
            elRegenState.textContent = `‚ö° Charging (+${game.upgrades.reg.val}/s)`;
            let lInfo = LEAGUES[game.leagueIndex]; elLeague.textContent = `${lInfo.name} League`; elLeague.style.color=lInfo.color; elLeague.style.borderColor=lInfo.color;
            document.getElementById('voucherCount').innerText = game.vouchers || 0;
            if(game.leagueIndex===3) elTapBtn.classList.add('diamond-mode'); else elTapBtn.classList.remove('diamond-mode');
        }

        window.toggleAnim = () => { game.settings.animations = document.getElementById('animToggle').checked; saveGame(); };
        window.openModal = (id) => { document.getElementById(id).style.display = 'flex'; if(id==='upgModal') renderUpgrades(); if(id==='walletModal') {renderStaking(); updateAirdropTimer();} if(id==='friendsModal') renderFriends(); };
        window.closeModals = () => document.querySelectorAll('.modal').forEach(el => el.style.display = 'none');

        function saveGame() { localStorage.setItem('ucbg_v1_6', JSON.stringify(game)); }
        function loadGame() {
            let s = localStorage.getItem('ucbg_v1_6');
            if(s) { 
                let d = JSON.parse(s); game={...game, ...d}; 
                if(!game.settings) game.settings={animations:true};
                if(!game.staking) game.staking={activePlan:-1, accumulated:0, lastCalc:Date.now()};
                if(!game.friends) game.friends=[];
            }
        }

        window.onload = init;
    </script>
</body>
</html>

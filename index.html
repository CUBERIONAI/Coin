<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ukrainian Cyborgs 2.0</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        /* --- UKRAINIAN CYBERPUNK 2.0 THEME --- */
        :root {
            --primary: #00BFFF;   /* Cyan */
            --accent: #FFD700;    /* Yellow */
            --bronze: #cd7f32;
            --silver: #e0e0e0;
            --gold: #FFD700;
            --diamond: #00ffff;
            --bg-dark: #050505;
            --card-bg: #141414;
            --danger: #ff3b30;
            --vip-bg: linear-gradient(135deg, #1a1a1a, #2a2a2a);
        }

        body {
            font-family: 'Courier New', monospace;
            background-color: var(--bg-dark);
            color: #fff; margin: 0; padding: 0;
            display: flex; flex-direction: column; align-items: center;
            height: 100vh; overflow: hidden;
            user-select: none; -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 90px;
        }

        /* –§–û–ù */
        .bg-fx {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: 
                radial-gradient(circle at 50% 50%, rgba(0, 40, 80, 0.4), #000 80%),
                url('data:image/svg+xml;utf8,<svg width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"><g fill="%2300BFFF" fill-opacity="0.05"><path d="M0 0h40v40H0z" fill="none"/><path d="M0 38h40v2H0z"/></g></svg>'); 
            z-index: -2;
        }

        /* –Ü–ù–¢–†–û */
        #intro-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999; display: flex; 
            flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.5s;
        }
        .intro-msg { color: var(--primary); font-size: 18px; letter-spacing: 2px; animation: glitch 1s infinite; text-align: center; text-transform: uppercase; }
        @keyframes glitch { 
            0% { text-shadow: 2px 0 red, -2px 0 blue; }
            5% { text-shadow: 2px 0 red, -2px 0 blue; }
            10% { text-shadow: none; } 
        }

        /* HEADER */
        .top-bar {
            width: 100%; max-width: 420px; padding: 10px 15px; 
            display: flex; justify-content: space-between; align-items: center;
            box-sizing: border-box;
        }
        .settings-icon { font-size: 24px; cursor: pointer; opacity: 0.8; transition: transform 0.3s; }
        .settings-icon:hover { transform: rotate(90deg); }

        /* –ì–û–õ–û–í–ù–ò–ô –ï–ö–†–ê–ù */
        .container { width: 100%; max-width: 420px; padding: 0 15px; box-sizing: border-box; text-align: center; z-index: 1; flex-grow: 1; display: flex; flex-direction: column; }

        h1 { font-family: sans-serif; font-size: 18px; color: var(--accent); text-transform: uppercase; letter-spacing: 2px; margin: 0; text-shadow: 0 0 10px var(--accent); }

        .balance-container { margin: 15px 0; }
        .balance-val { font-size: 42px; font-weight: 800; font-family: sans-serif; text-shadow: 0 0 15px var(--primary); display: flex; align-items: center; justify-content: center; gap: 10px; }
        .currency-icon { width: 32px; height: 32px; border-radius: 50%; background: var(--accent); display: inline-block; box-shadow: 0 0 10px var(--accent); }
        
        /* LEAGUE BADGE */
        .league-badge {
            display: inline-block; padding: 4px 12px; border-radius: 12px;
            background: rgba(255,255,255,0.05); border: 1px solid #444;
            font-size: 12px; font-weight: bold; margin-top: 5px; color: #ccc;
            transition: all 0.3s ease; text-transform: uppercase;
        }

        /* –ö–ù–û–ü–ö–ê-–¢–†–ò–ó–£–ë */
        .clicker-area {
            flex-grow: 1; display: flex; justify-content: center; align-items: center;
            margin: 10px 0; position: relative;
            width: 100%; 
        }
        .main-btn {
            width: 75vw; height: 75vw; max-width: 280px; max-height: 280px;
            border-radius: 50%;
            background: radial-gradient(circle, #152b3c, #000);
            border: 3px solid #333;
            box-shadow: 0 0 30px rgba(0, 191, 255, 0.2);
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; position: relative; overflow: hidden;
            transition: transform 0.05s, box-shadow 0.3s;
            -webkit-touch-callout: none;
        }
        
        .main-btn:active { transform: scale(0.96); }

        /* SKINS */
        .skin-gold { border-color: var(--gold); box-shadow: 0 0 40px var(--gold), inset 0 0 20px var(--gold); }
        .skin-diamond { 
            border-color: var(--diamond); 
            box-shadow: 0 0 50px var(--diamond), inset 0 0 30px var(--diamond);
            animation: diamondPulse 2s infinite; 
        }

        @keyframes diamondPulse { 0% { box-shadow: 0 0 50px var(--diamond); } 50% { box-shadow: 0 0 80px var(--diamond); } 100% { box-shadow: 0 0 50px var(--diamond); } }

        .trident-svg { width: 70%; height: 70%; filter: drop-shadow(0 0 15px var(--primary)); pointer-events: none; }
        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.03); } }
        .trident-anim { animation: breathe 3s infinite ease-in-out; }

        /* –ï–ù–ï–†–ì–Ü–Ø */
        .energy-bar {
            width: 100%; height: 8px; background: #222; border-radius: 4px;
            overflow: hidden; margin-top: auto; margin-bottom: 5px; border: 1px solid #444;
        }
        .energy-fill { height: 100%; background: linear-gradient(90deg, var(--primary), #0055ff); width: 100%; transition: width 0.3s; }
        .energy-info { display: flex; justify-content: space-between; font-size: 11px; color: #aaa; margin-bottom: 15px; font-family: sans-serif; font-weight: bold; }

        /* –ê–í–¢–û-–ë–û–¢ –ü–ê–ù–ï–õ–¨ */
        .bot-panel {
            background: rgba(0, 191, 255, 0.1); border: 1px solid var(--primary);
            border-radius: 12px; padding: 10px 15px; margin-bottom: 10px;
            display: none; justify-content: space-between; align-items: center;
        }

        /* –¶–ò–§–†–ò (+1) */
        .floating-txt {
            position: absolute; color: #fff; font-weight: 900; font-size: 32px;
            text-shadow: 0 0 10px var(--primary); pointer-events: none; z-index: 1000;
            animation: floatUp 0.8s ease-out forwards;
        }
        @keyframes floatUp { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-80px) scale(1.2); opacity: 0; } }

        /* –ù–ê–í–Ü–ì–ê–¶–Ü–Ø */
        .nav-bar {
            position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%);
            width: 94%; max-width: 400px; background: rgba(20, 20, 20, 0.9);
            backdrop-filter: blur(12px); border-radius: 20px; border: 1px solid #333;
            display: flex; justify-content: space-around; padding: 10px 5px; z-index: 100;
        }
        .nav-btn { background: none; border: none; color: #666; font-size: 10px; display: flex; flex-direction: column; align-items: center; cursor: pointer; flex: 1; }
        .nav-btn.active { color: var(--accent); }
        .nav-icon { font-size: 20px; margin-bottom: 3px; }

        /* –ú–û–î–ê–õ–ö–ò */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; justify-content: center; align-items: flex-end; }
        .modal-card { background: #111; width: 100%; max-width: 500px; border-radius: 25px 25px 0 0; padding: 25px; max-height: 85vh; overflow-y: auto; border-top: 2px solid var(--primary); color: #fff; box-sizing: border-box; padding-bottom: 80px; }
        .close-btn { position: absolute; top: 20px; right: 20px; font-size: 24px; color: #666; cursor: pointer; }
        
        h2 { font-size: 18px; color: var(--primary); margin-top: 0; text-transform: uppercase; border-bottom: 1px solid #333; padding-bottom: 10px; }

        .upg-row { display: flex; justify-content: space-between; align-items: center; background: #1a1a1a; padding: 12px; border-radius: 12px; margin-bottom: 8px; border: 1px solid #333; }
        .btn { background: var(--primary); color: #000; border: none; padding: 8px 16px; border-radius: 8px; font-weight: bold; font-size: 12px; cursor: pointer; transition: 0.2s; }
        .btn:disabled { background: #333; color: #555; pointer-events: none; }
        .btn-vip { background: linear-gradient(45deg, #FFD700, #FFA500); width: 100%; padding: 10px; margin-top: 5px; }
        
        /* VIP CARDS */
        .vip-card { background: var(--vip-bg); border: 1px solid #444; border-radius: 10px; padding: 15px; margin-bottom: 10px; position: relative; overflow: hidden; }
        .vip-card.active-vip { border: 1px solid var(--accent); box-shadow: 0 0 15px rgba(255, 215, 0, 0.2); }
        .vip-badge { position: absolute; top: 10px; right: 10px; background: #333; padding: 2px 8px; border-radius: 4px; font-size: 10px; }

        /* Toggle Switch */
        .switch { position: relative; display: inline-block; width: 50px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #333; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(26px); }

        #turboTimer { position: absolute; bottom: -30px; font-weight: bold; font-size: 14px; text-shadow: 0 0 5px red; display: none; }

    </style>
</head>
<body>

    <div id="intro-layer" onclick="startGame()">
        <div class="intro-msg">
            <span id="txt_intro_1">CONNECTION ESTABLISHED</span><br>
            <span style="font-size:12px; color:#555; margin-top:10px; display:block;" id="txt_intro_2">[ TAP TO INITIALIZE ]</span>
        </div>
    </div>

    <div class="bg-fx"></div>

    <div class="top-bar">
        <div style="font-size:12px; color:#888;">v2.0</div>
        <div class="settings-icon" onclick="openModal('settingsModal')">‚öôÔ∏è</div>
    </div>

    <div class="container">
        <h1 id="ui_title">UKRAINIAN CYBORGS</h1>

        <div class="balance-container">
            <div class="balance-val">
                <div class="currency-icon"></div>
                <span id="displayBalance">0</span>
            </div>
            <div class="league-badge" id="leagueDisplay">Bronze League</div>
        </div>

        <div class="bot-panel" id="botPanel">
            <div style="display:flex; align-items:center; gap:10px;">
                <span style="font-size:24px;">ü§ñ</span>
                <div style="text-align:left;">
                    <div style="font-size:12px; color:#aaa;">Auto-Bot Status</div>
                    <div style="font-family:monospace; font-weight:bold; color:var(--primary);" id="botTimer">ACTIVE</div>
                </div>
            </div>
            <button class="btn" id="claimBotBtn" onclick="claimBot()">CLAIM</button>
        </div>

        <div class="clicker-area">
            <div class="main-btn" id="tapBtn">
                <svg class="trident-svg trident-anim" viewBox="0 0 512 512">
                    <defs>
                        <linearGradient id="grad1" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#00BFFF;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#FFD700;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <path fill="url(#grad1)" d="M256 32C242.7 32 232 42.7 232 56V192C232 222.9 206.9 248 176 248C145.1 248 120 222.9 120 192V88C120 74.7 109.3 64 96 64C82.7 64 72 74.7 72 88V192C72 249.4 118.6 296 176 296H200V424H152C138.7 424 128 434.7 128 448C128 461.3 138.7 472 152 472H360C373.3 472 384 461.3 384 448C384 434.7 373.3 424 360 424H312V296H336C393.4 296 440 249.4 440 192V88C440 74.7 429.3 64 416 64C402.7 64 392 74.7 392 88V192C392 222.9 366.9 248 336 248C305.1 248 280 222.9 280 192V56C280 42.7 269.3 32 256 32z"/>
                </svg>
            </div>
            <div id="turboTimer">ROCKET: 10s</div>
        </div>

        <div class="energy-bar"><div class="energy-fill" id="energyFill"></div></div>
        <div class="energy-info">
            <span>‚ö° <span id="enVal">1000</span> / <span id="enMax">1000</span></span>
            <span id="regenState" style="color:var(--primary);">Standby</span>
        </div>
    </div>

    <div class="nav-bar">
        <button class="nav-btn active" onclick="closeModals()"><div class="nav-icon">üè†</div><span class="t-base">Base</span></button>
        <button class="nav-btn" onclick="openModal('upgModal')"><div class="nav-icon">üõ†</div><span class="t-upg">Upgrade</span></button>
        <button class="nav-btn" onclick="openModal('tasksModal')"><div class="nav-icon">üìã</div><span class="t-tasks">Tasks</span></button>
        <button class="nav-btn" onclick="openModal('vipModal')"><div class="nav-icon">üëë</div><span class="t-vip">VIP</span></button>
        <button class="nav-btn" onclick="openModal('walletModal')"><div class="nav-icon">üíé</div><span class="t-wallet">Wallet</span></button>
    </div>

    <div id="upgModal" class="modal">
        <div class="modal-card">
            <span class="close-btn" onclick="closeModals()">&times;</span>
            <h2 class="t-arsenal">ARSENAL</h2>
            
            <div class="upg-row" style="border-color:var(--accent);">
                <div>
                    <div style="font-size:14px; font-weight:bold; color:var(--accent);" class="t-bot">ü§ñ Auto-Bot</div>
                    <div style="font-size:10px; color:#888;">Offline Mining (4h)</div>
                </div>
                <button class="btn" id="buyBotBtn" onclick="buyBot()">250k</button>
            </div>

            <div class="upg-row" style="border-color:var(--danger);">
                <div>
                    <div style="font-size:14px; font-weight:bold; color:var(--danger);" class="t-rocket">üöÄ Rocket (x10)</div>
                    <div style="font-size:10px; color:#888;"><span id="rocketsLeft">3</span>/3 Daily</div>
                </div>
                <button class="btn" id="btnRocket" style="background:var(--danger); color:#fff;" onclick="activateRocket()">START</button>
            </div>

            <hr style="border-color:#333; margin:15px 0;">
            <div id="upgradesList"></div>
        </div>
    </div>

    <div id="vipModal" class="modal">
        <div class="modal-card">
            <span class="close-btn" onclick="closeModals()">&times;</span>
            <h2>VIP MILITARY PASS</h2>
            <p style="font-size:11px; color:#888; margin-bottom:15px;">Buy with TON to boost UCBG production.</p>
            
            <div id="vipList"></div>
        </div>
    </div>

    <div id="tasksModal" class="modal">
        <div class="modal-card">
            <span class="close-btn" onclick="closeModals()">&times;</span>
            <h2 class="t-tasks">MISSIONS</h2>
            
            <div class="upg-row">
                <div>
                    <div style="font-weight:bold;">Invite Recruit</div>
                    <div style="font-size:10px; color:#aaa;">+2500 UCBG</div>
                </div>
                <button class="btn" onclick="invite()">INVITE</button>
            </div>
            
            <div class="upg-row">
                <div>
                    <div style="font-weight:bold;">Join Squad Channel</div>
                    <div style="font-size:10px; color:#aaa;">+5000 UCBG</div>
                </div>
                <button class="btn" onclick="TG.openTelegramLink('https://t.me/ucbgcoin_channel')">JOIN</button>
            </div>
        </div>
    </div>

    <div id="walletModal" class="modal">
        <div class="modal-card">
            <span class="close-btn" onclick="closeModals()">&times;</span>
            <h2 class="t-wallet">WALLET</h2>
            <div style="background:#1a1a1a; padding:20px; border-radius:15px; text-align:center; margin-bottom:20px;">
                <div id="ton-btn" style="display:flex; justify-content:center;"></div>
            </div>
            
            <h3 style="font-size:14px; color:var(--accent);">STAKING (Beta)</h3>
            <div class="upg-row" style="border: 1px dashed #555;">
                <div style="font-size:12px; color:#aaa;">Stake TON -> Get UCBG<br>APY: 150%</div>
                <button class="btn" style="background:#333;">SOON</button>
            </div>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-card">
            <span class="close-btn" onclick="closeModals()">&times;</span>
            <h2>SETTINGS</h2>
            <div class="upg-row" style="border-color:#555;">
                <div>
                    <div style="font-size:14px; font-weight:bold;">Animations</div>
                    <div style="font-size:10px; color:#888;">Reduce battery usage</div>
                </div>
                <label class="switch">
                    <input type="checkbox" id="animToggle" onchange="toggleAnim()">
                    <span class="slider"></span>
                </label>
            </div>
            <div style="text-align:center; color:#555; font-size:10px; margin-top:20px;">
                Cyborg v2.0 <br> Based on Real Events
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURATION & LOCALIZATION ---
        const TG = window.Telegram.WebApp;
        TG.expand(); TG.setHeaderColor('#050505');

        const LANGS = {
            en: {
                base: "Base", upg: "Upgrade", tasks: "Missions", vip: "VIP", wallet: "Wallet",
                arsenal: "ARSENAL", bot: "Auto-Bot", rocket: "Rocket Strike",
                intro1: "SYSTEM DETECTED", intro2: "[ TAP TO INITIALIZE ]",
                league: "League", loading: "Connecting...",
                vipnames: ["None", "Bronze", "Silver", "Gold", "Diamond"]
            },
            uk: {
                base: "–ë–∞–∑–∞", upg: "–ê—Ä—Å–µ–Ω–∞–ª", tasks: "–ú—ñ—Å—ñ—ó", vip: "VIP", wallet: "–ì–∞–º–∞–Ω–µ—Ü—å",
                arsenal: "–ê–†–°–ï–ù–ê–õ", bot: "–ê–≤—Ç–æ-–ë–æ—Ç", rocket: "–£–¥–∞—Ä –†–∞–∫–µ—Ç–∏",
                intro1: "–°–ò–°–¢–ï–ú–ê –í–ò–Ø–í–õ–ï–ù–ê", intro2: "[ –ù–ê–¢–ò–°–ù–Ü–¢–¨ –î–õ–Ø –°–¢–ê–†–¢–£ ]",
                league: "–õ—ñ–≥–∞", loading: "–ó'—î–¥–Ω–∞–Ω–Ω—è...",
                vipnames: ["–ù–µ–º–∞—î", "Bronze", "Silver", "Gold", "Diamond"]
            },
            ru: {
                base: "–ë–∞–∑–∞", upg: "–ê—Ä—Å–µ–Ω–∞–ª", tasks: "–ú–∏—Å—Å–∏–∏", vip: "VIP", wallet: "–ö–æ—à–µ–ª–µ–∫",
                arsenal: "–ê–†–°–ï–ù–ê–õ", bot: "–ê–≤—Ç–æ-–ë–æ—Ç", rocket: "–†–∞–∫–µ—Ç–Ω—ã–π –£–¥–∞—Ä",
                intro1: "–°–ò–°–¢–ï–ú–ê –û–ë–ù–ê–†–£–ñ–ï–ù–ê", intro2: "[ –ù–ê–ñ–ú–ò–¢–ï –î–õ–Ø –°–¢–ê–†–¢–ê ]",
                league: "–õ–∏–≥–∞", loading: "–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ...",
                vipnames: ["–ù–µ—Ç", "Bronze", "Silver", "Gold", "Diamond"]
            }
        };

        // Detect language
        let userLang = TG.initDataUnsafe?.user?.language_code || 'en';
        if(userLang !== 'uk' && userLang !== 'ru') userLang = 'en';
        const TXT = LANGS[userLang];

        // Apply Text
        function applyLang() {
            document.querySelector('.t-base').textContent = TXT.base;
            document.querySelector('.t-upg').textContent = TXT.upg;
            document.querySelector('.t-tasks').textContent = TXT.tasks;
            document.querySelector('.t-vip').textContent = TXT.vip;
            document.querySelector('.t-wallet').textContent = TXT.wallet;
            document.querySelector('.t-arsenal').textContent = TXT.arsenal;
            document.querySelector('.t-bot').textContent = TXT.bot;
            document.querySelector('.t-rocket').textContent = TXT.rocket;
            document.getElementById('txt_intro_1').textContent = TXT.intro1;
            document.getElementById('txt_intro_2').textContent = TXT.intro2;
        }

        // --- GAME CONSTANTS ---
        const LEAGUES = [
            { name: "Recruit", limit: 0, reward: 0, color: "var(--bronze)" },
            { name: "Soldier", limit: 50000, reward: 5000, color: "var(--silver)" },
            { name: "Veteran", limit: 500000, reward: 25000, color: "var(--gold)" },
            { name: "Cyborg", limit: 10000000, reward: 100000, color: "var(--diamond)" }
        ];

        const VIP_TIERS = [
            { id: 'bronze', name: 'Bronze VIP', cost: 5, mult: 1.1, desc: '+10% Mining' },
            { id: 'silver', name: 'Silver VIP', cost: 100, mult: 1.5, desc: '+50% Mining' },
            { id: 'gold', name: 'Gold VIP', cost: 200, mult: 3.0, desc: '+200% + Gold Skin' },
            { id: 'diamond', name: 'Diamond VIP', cost: 500, mult: 4.0, desc: '+300% + AutoClick + FX' }
        ];

        // --- GAME STATE ---
        let game = {
            balance: 0,
            energy: 1000,
            leagueIndex: 0,
            hasPlayed: false,
            hasBot: false,
            botStartTime: 0,
            turboEnd: 0,
            clickCount: 0,
            vipLevel: -1, // -1 none, 0 bronze, etc.
            rockets: { count: 3, lastDate: 0 },
            settings: { animations: true },
            upgrades: {
                tap: { lvl: 1, base: 500, factor: 2, val: 1 },
                eng: { lvl: 1, base: 500, factor: 2, val: 1000 },
                reg: { lvl: 1, base: 1000, factor: 2.5, val: 2 }
            }
        };

        // --- INIT ---
        function init() {
            applyLang();
            loadGame();

            if (!game.hasPlayed) {
                game.balance = 1000;
                game.hasPlayed = true;
                saveGame();
            }

            // Daily Reset Logic
            const today = new Date().toDateString();
            if(game.rockets.lastDate !== today) {
                game.rockets.count = 3;
                game.rockets.lastDate = today;
                saveGame();
            }

            document.getElementById('animToggle').checked = game.settings.animations;
            applyAnimationsSetting();
            updateUI();
            checkLeague(); 
            renderUpgrades();
            renderVIP();

            // Loops
            setInterval(() => {
                regenEnergy();
                updateBot();
                checkTurbo();
                // Diamond Auto Click
                if(game.vipLevel === 3 && game.energy > 0) {
                     simulateTap(false); 
                }
            }, 1000);

            setInterval(() => { game.clickCount = 0; }, 2000);

            // TON Connect
            new TON_CONNECT_UI.TonConnectUI({
                manifestUrl: 'https://raw.githubusercontent.com/ton-community/tutorials/main/03-client/test/public/tonconnect-manifest.json',
                buttonRootId: 'ton-btn'
            });
        }

        // --- CORE LOGIC ---
        window.startGame = () => {
            const el = document.getElementById('intro-layer');
            el.style.opacity = '0';
            setTimeout(() => el.style.display = 'none', 500);
        };

        document.getElementById('tapBtn').addEventListener('pointerdown', (e) => {
            e.preventDefault();
            simulateTap(true, e.clientX, e.clientY);
        });

        function simulateTap(manual, x = 0, y = 0) {
            if(manual && game.clickCount > 30) return; // Anti-cheat

            let basePower = game.upgrades.tap.val + (game.upgrades.tap.lvl - 1);
            
            // VIP Multiplier
            if(game.vipLevel >= 0) {
                basePower = Math.floor(basePower * VIP_TIERS[game.vipLevel].mult);
            }

            // Rocket Multiplier
            if (Date.now() < game.turboEnd) basePower *= 10;

            if (game.energy >= basePower) {
                game.balance += basePower;
                game.energy -= basePower;
                if(manual) game.clickCount++;
                
                if(manual && TG.HapticFeedback && game.settings.animations) TG.HapticFeedback.impactOccurred('light');

                if(manual && game.settings.animations) {
                    const btn = document.getElementById('tapBtn');
                    btn.style.transform = "scale(0.95)";
                    setTimeout(() => btn.style.transform = "scale(1)", 80);
                    showFloatingText(x, y, `+${basePower}`);
                }

                updateUI();
                checkLeague();
            }
        }

        function showFloatingText(x, y, txt) {
            // If automated or missing coords, center it
            if(!x || !y) {
                const rect = document.getElementById('tapBtn').getBoundingClientRect();
                x = rect.left + rect.width/2;
                y = rect.top + rect.height/2;
            }
            let el = document.createElement('div');
            el.className = 'floating-txt';
            el.textContent = txt;
            // Add some random scatter
            x += (Math.random() * 40 - 20);
            el.style.left = (x - 20) + 'px';
            el.style.top = (y - 40) + 'px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 800);
        }

        // --- LEAGUES & UI ---
        function checkLeague() {
            let next = game.leagueIndex + 1;
            if (next < LEAGUES.length && game.balance >= LEAGUES[next].limit) {
                game.leagueIndex = next;
                game.balance += LEAGUES[next].reward;
                TG.showAlert(`üèÜ RANK PROMOTION: ${LEAGUES[next].name}\nBonus: +${LEAGUES[next].reward}`);
                saveGame();
            }
        }

        function updateUI() {
            document.getElementById('displayBalance').innerText = Math.floor(game.balance).toLocaleString();
            
            // Energy
            let cur = Math.floor(game.energy);
            let max = game.upgrades.eng.val;
            document.getElementById('enVal').innerText = cur;
            document.getElementById('enMax').innerText = max;
            document.getElementById('energyFill').style.width = (cur / max) * 100 + "%";
            document.getElementById('regenState').innerText = (cur < max) ? `Charging (+${game.upgrades.reg.val}/s)` : 'Ready';

            // League
            let lInfo = LEAGUES[game.leagueIndex];
            const lDisp = document.getElementById('leagueDisplay');
            lDisp.innerText = `${lInfo.name} League`;
            lDisp.style.color = lInfo.color;
            lDisp.style.borderColor = lInfo.color;

            // Rocket Count
            document.getElementById('rocketsLeft').innerText = game.rockets.count;

            // SKINS logic
            const btn = document.getElementById('tapBtn');
            btn.className = 'main-btn'; // reset
            if(game.settings.animations) btn.classList.add('anim-active');
            
            if(game.vipLevel === 2) btn.classList.add('skin-gold'); // Gold
            if(game.vipLevel === 3) btn.classList.add('skin-diamond'); // Diamond
            
            saveGame(); // Auto-save on UI update (throttled by JS execution usually, but safe for clickers)
        }

        // --- UPGRADES ---
        function renderUpgrades() {
            const list = document.getElementById('upgradesList');
            list.innerHTML = '';
            const items = [
                { id: 'tap', name: "Multitap", desc: "Click Power" },
                { id: 'eng', name: "Battery", desc: "Energy Cap" },
                { id: 'reg', name: "Generator", desc: "Recharge Speed" }
            ];

            items.forEach(i => {
                let u = game.upgrades[i.id];
                let cost = Math.floor(u.base * Math.pow(u.factor, u.lvl - 1));
                
                list.innerHTML += `
                <div class="upg-row">
                    <div>
                        <div style="font-size:14px; font-weight:bold;">${i.name} <span style="color:var(--primary)">Lvl ${u.lvl}</span></div>
                        <div style="font-size:10px; color:#888;">${i.desc}</div>
                    </div>
                    <button class="btn" onclick="buy('${i.id}', ${cost})" ${game.balance < cost ? 'disabled' : ''}>
                        ${cost.toLocaleString()}
                    </button>
                </div>`;
            });
        }

        window.buy = (id, cost) => {
            if(game.balance >= cost) {
                game.balance -= cost;
                game.upgrades[id].lvl++;
                if(id === 'eng') game.upgrades.eng.val += 500;
                if(id === 'reg') game.upgrades.reg.val += 2;
                updateUI(); renderUpgrades(); 
            }
        };

        // --- VIP SYSTEM ---
        function renderVIP() {
            const list = document.getElementById('vipList');
            list.innerHTML = '';
            
            VIP_TIERS.forEach((v, idx) => {
                const isOwned = game.vipLevel >= idx;
                const isCurrent = game.vipLevel === idx;
                
                let btnTxt = isOwned ? "OWNED" : `${v.cost} TON`;
                let btnClass = isOwned ? "btn" : "btn btn-vip";
                let action = isOwned ? "" : `onclick="buyVIP(${idx})"`;
                let activeClass = isCurrent ? "active-vip" : "";

                list.innerHTML += `
                <div class="vip-card ${activeClass}">
                    <div class="vip-badge">${v.name}</div>
                    <div style="font-size:20px; font-weight:bold; color:${getVipColor(idx)}">x${v.mult} Multiplier</div>
                    <div style="font-size:12px; color:#ccc; margin:5px 0;">${v.desc}</div>
                    <button class="${btnClass}" ${action} ${isOwned?'disabled':''}>${btnTxt}</button>
                </div>`;
            });
        }

        function getVipColor(idx) {
            if(idx==0) return 'var(--bronze)';
            if(idx==1) return 'var(--silver)';
            if(idx==2) return 'var(--gold)';
            return 'var(--diamond)';
        }

        window.buyVIP = (levelIndex) => {
            // Frontend Simulation of TON Payment
            // In production, this would use tonConnectUI.sendTransaction()
            TG.showConfirm(`Buy ${VIP_TIERS[levelIndex].name} for ${VIP_TIERS[levelIndex].cost} TON?`, (ok) => {
                if(ok) {
                    TG.showAlert("Payment Processed! VIP Activated.");
                    game.vipLevel = levelIndex;
                    // Add some UCBG bonus for purchase
                    game.balance += 50000 * (levelIndex + 1);
                    renderVIP();
                    updateUI();
                }
            });
        };

        // --- SPECIALS ---
        window.buyBot = () => {
            if(game.balance >= 250000 && !game.hasBot) {
                game.balance -= 250000;
                game.hasBot = true;
                game.botStartTime = Date.now();
                updateUI();
                closeModals();
            }
        };

        window.claimBot = () => {
            game.balance += 50000; // Base claim
            game.botStartTime = Date.now();
            updateUI();
        };

        function updateBot() {
            if(!game.hasBot) {
                document.getElementById('botPanel').style.display = 'none';
                return;
            }
            document.getElementById('botPanel').style.display = 'flex';
            document.getElementById('buyBotBtn').textContent = "INSTALLED";
            document.getElementById('buyBotBtn').disabled = true;

            const diff = Date.now() - game.botStartTime;
            const limit = 4 * 60 * 60 * 1000; 
            const elTime = document.getElementById('botTimer');

            if(diff >= limit) {
                elTime.textContent = "FULL STORAGE";
                elTime.style.color = "#0f0";
                document.getElementById('claimBotBtn').disabled = false;
            } else {
                const left = limit - diff;
                const h = Math.floor(left / 3600000);
                const m = Math.floor((left % 3600000) / 60000);
                elTime.textContent = `${h}h ${m}m remaining`;
                elTime.style.color = "var(--primary)";
                document.getElementById('claimBotBtn').disabled = true;
            }
        }

        window.activateRocket = () => {
            if(game.rockets.count > 0 && Date.now() > game.turboEnd) {
                game.rockets.count--;
                game.turboEnd = Date.now() + 10000; 
                closeModals();
                renderUpgrades(); // refresh counter UI in modal
            }
        };

        function checkTurbo() {
            const el = document.getElementById('turboTimer');
            if(Date.now() < game.turboEnd) {
                el.style.display = 'block';
                const left = Math.ceil((game.turboEnd - Date.now())/1000);
                el.textContent = `üöÄ STRIKE MODE: ${left}s`;
                document.getElementById('tapBtn').style.borderColor = 'var(--danger)';
            } else {
                el.style.display = 'none';
                document.getElementById('tapBtn').style.borderColor = '#333';
            }
        }

        // --- UTILS ---
        window.toggleAnim = () => {
            game.settings.animations = document.getElementById('animToggle').checked;
            applyAnimationsSetting();
        };

        function applyAnimationsSetting() {
            const btn = document.getElementById('tapBtn');
            const svg = document.querySelector('.trident-svg');
            if(game.settings.animations) {
                btn.classList.add('anim-active');
                svg.classList.add('trident-anim');
            } else {
                btn.classList.remove('anim-active');
                svg.classList.remove('trident-anim');
            }
        }

        function regenEnergy() {
            let max = game.upgrades.eng.val;
            if (game.energy < max) {
                game.energy = Math.min(max, game.energy + game.upgrades.reg.val);
                updateUI();
            }
        }

        window.invite = () => {
            game.balance += 2500;
            TG.openTelegramLink("https://t.me/share/url?url=https://t.me/ucbgcoin_bot&text=Join+Cyborgs+Resistance!");
            closeModals();
            TG.showAlert("Referral link generated! (+2500 bonus)");
        };
        
        window.openModal = (id) => {
            document.getElementById(id).style.display = 'flex';
            if(id === 'upgModal') renderUpgrades();
        };
        window.closeModals = () => document.querySelectorAll('.modal').forEach(el => el.style.display = 'none');

        // Storage
        function saveGame() { localStorage.setItem('ucbg_v2', JSON.stringify(game)); }
        function loadGame() {
            let s = localStorage.getItem('ucbg_v2');
            if(s) {
                let d = JSON.parse(s);
                game = {...game, ...d};
            }
        }

        window.onload = init;
    </script>
</body>
</html>
